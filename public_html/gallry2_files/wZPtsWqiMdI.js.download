;/*FB_PKG_DELIM*/

__d("EncryptedBackupsDYIPasswordReauthDialogQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="8728569200551000"}),null);
__d("EncryptedBackupsDYIPasswordReauthDialogQuery$Parameters",["EncryptedBackupsDYIPasswordReauthDialogQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a={kind:"PreloadableConcreteRequest",params:{id:b("EncryptedBackupsDYIPasswordReauthDialogQuery_facebookRelayOperation"),metadata:{},name:"EncryptedBackupsDYIPasswordReauthDialogQuery",operationKind:"query",text:null}};e.exports=a}),null);
__d("VideoPlayerScrubberRenderer_video.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VideoPlayerScrubberRenderer_video",selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"video_player_scrubber_base_content_renderer",plural:!1,selections:[{kind:"InlineFragment",selections:[{args:null,documentName:"VideoPlayerScrubberRenderer_video",fragmentName:"VideoPlayerScrubberBaseContentSegmented_renderer",fragmentPropName:"renderer",kind:"ModuleImport"}],type:"XFBVideoPlayerScrubberBaseContentSegmentedRenderer",abstractKey:null}],storageKey:null}],type:"Video",abstractKey:null};e.exports=a}),null);
__d("CometContextualMessage.react",["fbt","ix","CometIcon.react","CometRow.react","CometRowItem.react","FbtResultBase","TetraTextPairing.react","fbicon","react","stylex"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k,l=k||d("react"),m={closeButton:{marginEnd:"xcud41i",marginLeft:null,marginRight:null,marginTop:"x9otpla",$$css:!0},icon:{marginTop:"x1rdy4ex",$$css:!0},root:{borderTopStartRadius:"x1lq5wgf",borderTopEndRadius:"xgqcy7u",borderBottomEndRadius:"x30kzoy",borderBottomStartRadius:"x9jhf4c",overflowX:"x6ikm8r",overflowY:"x10wlt62",paddingTop:"x1iorvi4",paddingEnd:"x150jy0e",paddingBottom:"x1l90r2v",paddingStart:"x1e558r4",$$css:!0}},n={highlight:{backgroundColor:"xwnonoy",$$css:!0},"highlight-bg":{backgroundColor:"xfmpgtx",$$css:!0},primary:{backgroundColor:"x1jx94hy",$$css:!0},secondary:{backgroundColor:"xlhe6ec",$$css:!0}};function a(a,b){var e=a.addOnPrimary,f=a.addOnSecondary,g=a.body,k=a.headline,o=a.headlineLineLimit,p=a.icon,q=a.level;q=q===void 0?3:q;var r=a.meta,s=a.testid;s=a.type;s=s===void 0?"primary":s;var t=a.onClose!=null?a.onClose:null;a=a.headlineAriaLabel!=null?a.headlineAriaLabel:typeof k==="string"||k instanceof c("FbtResultBase")?k:null;return l.jsxs("div",{className:(j||(j=c("stylex")))(m.root,n[s]),"data-testid":void 0,ref:b,children:[l.jsxs(c("CometRow.react"),{verticalAlign:"center",children:[p!=null?l.jsx(c("CometRowItem.react"),{verticalAlign:"top",children:l.jsx("div",{className:"x1rdy4ex",children:p})}):null,l.jsx(c("CometRowItem.react"),{expanding:!0,children:l.jsx(c("TetraTextPairing.react"),{body:g,bodyColor:s==="highlight"?"white":"secondary",headline:k,headlineColor:s==="highlight"?"white":"primary",headlineLineLimit:(b=o)!=null?b:2,level:q})}),t!=null?l.jsx(c("CometRowItem.react"),{verticalAlign:"top",children:l.jsx("div",{className:"xcud41i x9otpla",children:l.jsx(c("CometIcon.react"),{"aria-label":a!=null?h._("Dismiss {card name} card",[h._param("card name",a)]):h._("Dismiss card"),color:s==="highlight"?"white":"secondary",icon:d("fbicon")._(i("478232"),16),onPress:t,size:16,testid:void 0})})}):null]}),e,f,r!=null&&l.jsx(c("CometRow.react"),{paddingTop:12,children:l.jsx(c("CometRowItem.react"),{children:l.jsx(c("TetraTextPairing.react"),{level:q,meta:r})})})]})}a.displayName=a.name+" [from "+f.id+"]";b=l.forwardRef(a);g["default"]=b}),98);
__d("LSDataTraceTag",[],(function(a,b,c,d,e,f){"use strict";a=0;b=1;c=2;d=3;e=4;var g=5,h=6,i=7,j=20,k=21,l=22,m=23,n=24,o=25,p=26,q=27,r=28,s=29,t=30,u=31,v=32,w=33,x=34,y=35,z=36,A=37,B=38,C=39,D=40,E=41,F=42;f.none=a;f.sticker=b;f.image=c;f.animatedImage=d;f.video=e;f.audio=g;f.file=h;f.xma=i;f.messageTypeNone=j;f.messageTypeText=k;f.messageTypeFutureproof=l;f.messageTypeCiphertext=m;f.messageTypeUnavailable=n;f.messageTypeImage=o;f.messageTypeVideo=p;f.messageTypePtt=q;f.messageTypeAdmin=r;f.messageTypeRevoked=s;f.messageTypeGif=t;f.messageTypeSticker=u;f.messageTypeExpiredEphemeral=v;f.messageTypeEphemeralSettingAdmin=w;f.messageTypeEphemeralSyncResponse=x;f.messageTypeEphemeralScreenshotAction=y;f.messageTypeDeleteForMe=z;f.messageTypeEphemeralSettingChangeFromCurrentDevice=A;f.messageTypeAlertICDC=B;f.messageTypeGroupInvite=C;f.messageTypeXMA=D;f.messageTypeReaction=E;f.messageTypeSenderKeyDistribution=F}),66);
__d("MAWBridgeTrace",["WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f,g,h,i){var j=a.ack,k=a.externalId,l=a.ts;a=a.type;var m=d("WAJids").switchOnMsgrChatJidType(b,{group:function(a){return"Group"},user:function(a){return"User"}});return{ack:j,externalId:k,isFirstMsg:!!f,openMessageOtid:e,openMessageParticipantCount:g,participantCount:h,threadJid:b,threadKey:i,threadType:m,traceType:c,ts:l,type_:a}}function b(a,b,c){return{traceContext:c,traceId:b,traceType:a}}function c(a,b,c,d){return{errorMessage:d,event:b,externalIds:a,traceType:c}}function e(a,b,c,d,e,f){return{checkPointId:a,dataTraceId:b,errorMessage:c,shouldFlush:d,syncChannel:e,tags:f}}g.createBridgeStartTraceData=a;g.createBridgeStartTraceWithTraceIdData=b;g.createBridgeUpdateTraceData=c;g.createBridgeTraceRecordCheckpointData=e}),98);
__d("MAWTraceUtils",["LSDataTraceCheckPoint","LSDataTraceTag","LSIntEnum","LSRequestId","MAWBridge","MAWBridgeTrace","MAWMsgType"],(function(a,b,c,d,e,f,g){"use strict";var h,i="backup_upload",j="media_backup",k="vesta_registration",l="vesta_login";function m(){return c("LSRequestId").generate()}function a(a,b,c){c=(c=c)!=null?c:m();d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"StartTraceWithTraceId",value:d("MAWBridgeTrace").createBridgeStartTraceWithTraceIdData(a,c,b)}]},!0);return c}function n(a,b,c,e,f){if(a!=null){c=c.length>0?c.map(function(a){return a.toString()}).join(","):void 0;d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"TraceRecordCheckpoint",value:d("MAWBridgeTrace").createBridgeTraceRecordCheckpointData(b,a,f,e,-1,c)}]},!0)}}function b(a,b,e,f){n(a,b,e,!1),n(a,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_FOR_FAILURE),e,!0,f)}function e(a,b,e){n(a,b,e,!1),n(a,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_AND_FLUSH),e,!0)}function f(a,b,e){n(a,b,e,!1),n(a,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_AND_FLUSH),e,!0)}function o(a){switch(a){case d("MAWMsgType").MSG_TYPE.TEXT:return d("LSDataTraceTag").messageTypeText;case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:return d("LSDataTraceTag").messageTypeFutureproof;case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:return d("LSDataTraceTag").messageTypeCiphertext;case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:return d("LSDataTraceTag").messageTypeUnavailable;case d("MAWMsgType").MSG_TYPE.IMAGE:return d("LSDataTraceTag").messageTypeImage;case d("MAWMsgType").MSG_TYPE.VIDEO:return d("LSDataTraceTag").messageTypeVideo;case d("MAWMsgType").MSG_TYPE.PTT:return d("LSDataTraceTag").messageTypePtt;case d("MAWMsgType").MSG_TYPE.ADMIN:return d("LSDataTraceTag").messageTypeAdmin;case d("MAWMsgType").MSG_TYPE.REVOKED:return d("LSDataTraceTag").messageTypeRevoked;case d("MAWMsgType").MSG_TYPE.GIF:return d("LSDataTraceTag").messageTypeGif;case d("MAWMsgType").MSG_TYPE.STICKER:return d("LSDataTraceTag").messageTypeSticker;case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:return d("LSDataTraceTag").messageTypeExpiredEphemeral;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:return d("LSDataTraceTag").messageTypeEphemeralSettingAdmin;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:return d("LSDataTraceTag").messageTypeEphemeralSyncResponse;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:return d("LSDataTraceTag").messageTypeEphemeralScreenshotAction;case d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:return d("LSDataTraceTag").messageTypeDeleteForMe;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:return d("LSDataTraceTag").messageTypeEphemeralSettingChangeFromCurrentDevice;case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:return d("LSDataTraceTag").messageTypeAlertICDC;case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:return d("LSDataTraceTag").messageTypeGroupInvite;case d("MAWMsgType").MSG_TYPE.XMA:return d("LSDataTraceTag").messageTypeXMA;case d("MAWMsgType").MSG_TYPE.REACTION:return d("LSDataTraceTag").messageTypeReaction;case d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION:return d("LSDataTraceTag").messageTypeSenderKeyDistribution;default:return d("LSDataTraceTag").messageTypeNone}}g.CONTEXT_BACKUP_UPLOAD=i;g.CONTEXT_MEDIA_BACKUP=j;g.CONTEXT_VESTA_REGISTRATION=k;g.CONTEXT_VESTA_LOGIN=l;g.createTraceId=m;g.startNewTrace=a;g.recordCheckpointForTrace=n;g.recordFailureAndFlushForTraceId=b;g.recordSuccessAndFlushForTraceId=e;g.recordInvalidUploadRequestAndFlushTrace=f;g.getTagForMsgType=o}),98);
__d("MAWEBFrontendQPLLogger",["QPLUserFlow","Random","gkx","hashString","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=c("Random").uint32();c("QPLUserFlow").start(c("qpl")._(521478596,"1329"),{instanceKey:a});return a}function b(a){if(a==null)return;c("QPLUserFlow").addPoint(c("qpl")._(521478596,"1329"),"processing_threads_from_occamadillo",{instanceKey:a})}function d(a,b){if(a==null)return;b===!0?c("QPLUserFlow").addPoint(c("qpl")._(521478596,"1329"),"backup_restore_completed_success",{instanceKey:a}):c("QPLUserFlow").addPoint(c("qpl")._(521478596,"1329"),"backup_restore_completed_failed",{instanceKey:a})}function e(a,b,d){if(a==null)return;if(b===!0)c("QPLUserFlow").endSuccess(c("qpl")._(521478596,"1329"),{instanceKey:a});else{d=(b=d)!=null?b:"dyi_e2e_failed_unspecifed_reason";c("QPLUserFlow").endFailure(c("qpl")._(521478596,"1329"),d,{instanceKey:a})}}function f(a,b,d){if(c("gkx")("497")!==!0||a==null)return;a=c("hashString")(a);c("QPLUserFlow").addPoint(c("qpl")._(521485625,"1876"),b,{data:d,instanceKey:a})}function h(a,b,d){if(c("gkx")("497")!==!0||a==null)return;a=c("hashString")(a);c("QPLUserFlow").addPoint(c("qpl")._(521485625,"1876"),b,{data:d,instanceKey:a});c("QPLUserFlow").endCancel(c("qpl")._(521485625,"1876"),{annotations:d,instanceKey:a})}function i(a,b,d){if(c("gkx")("497")!==!0||a==null)return;a=c("hashString")(a);if(b){c("QPLUserFlow").endSuccess(c("qpl")._(521485625,"1876"),{instanceKey:a});return}c("QPLUserFlow").endFailure(c("qpl")._(521485625,"1876"),(b=d)!=null?b:"upload_message_backup_failed",{instanceKey:a})}function j(a,b,d){a=c("hashString")("UT"+a);c("QPLUserFlow").addPoint(c("qpl")._(521480745,"830"),b,{data:d,instanceKey:a})}function k(a){a=c("hashString")("UT"+a);c("QPLUserFlow").endSuccess(c("qpl")._(521480745,"830"),{instanceKey:a})}g.startDyiQplE2EUserFlow=a;g.logDyiE2EProcessThreadsFromOccamadillo=b;g.logDyiE2EDyiBackupRestoreCompleted=d;g.endDyiE2ECompleted=e;g.addPointUploadMessageBackup=f;g.addPointAndEndFlowUploadMessageBackup=h;g.endFlowUploadMessageBackup=i;g.addPointEBUploadTracking=j;g.endEBUploadTracking=k}),98);
__d("MAWEncryptedBackupUtils",["I64","LSAuthorityLevel","LSDataTraceCheckPoint","LSIntEnum","MAWEBFrontendQPLLogger","MAWTraceUtils","Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a,b,c,e,f){d("MAWTraceUtils").recordCheckpointForTrace(a,b,c,e,f)}function a(a,e){d("MAWEBFrontendQPLLogger").addPointUploadMessageBackup(e,"get_backup_tenancy");k(e,(j||(j=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_WEB_GET_BACKUP_TENANCY),[],!1);return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("secure_encrypted_backups_client_state"))).then(function(a){if(a==null)return(h||(h=b("Promise"))).resolve();var e=a.backupTenancy;a=a.authorityLevel;if(e!=null&&(i||(i=d("I64"))).equal((j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE),a))return e})}g.getBackupTenancy=a}),98);
__d("MAWReceiveToUploadUtils",["I64","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;b=c("justknobx")._("1693");e=100;var i=(h||(h=d("I64"))).of_int32(e*100),j=h.of_int32(e*b),k=new RegExp(/^[1-9]{1}[0-9]*$/);function a(a){if(!k.test(a))return!1;try{a=(h||(h=d("I64"))).of_string(a);return h.compare(h.mod_(a,i),j)<0}catch(a){return!1}}g.checkUploadEligbility=a}),98);
__d("MAWCreateOneToOneThread",["FBLogger","I64","LSAuthorityLevel","LSFactory","LSIntEnum","LSVerifyE2EEMetadataThreadExistsV2StoredProcedure","MAWBridgeSendAndReceive","MAWDbChatId","MAWJids","MAWJobDefinitions","MAWTimedJob","Promise","ReQL","WAJids","WAJobOrchestratorTypes"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,e,f){var g=(j||(j=d("I64"))).to_string(e);e=f!=null?(h||(h=b("Promise"))).resolve(f):a.runInTransaction(function(a){return c("LSVerifyE2EEMetadataThreadExistsV2StoredProcedure")(c("LSFactory")(a),{authorityLevel:(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),threadType:i.ofNumber(15)})},"readwrite").then(function(a){return(j||(j=d("I64"))).to_string(a[0])});return e.then(function(e){return(h||(h=b("Promise"))).all([d("MAWBridgeSendAndReceive").sendAndReceive("backend","createThread",{contactFbid:g,offlineThreadingId:e}).then(function(f){var g=f.chatId,i=f.created,k=f.jid;return a.runInTransaction(function(a){var f=(j||(j=d("I64"))).of_string(d("WAJids").threadIdForChatJid(k));return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("mi_act_mapping_table").index("jid")).getKeyRange(f)).then(function(l){if(l!=null)return(h||(h=b("Promise"))).resolve({chatId:d("MAWDbChatId").unsafeCoerceToChatId((j||(j=d("I64"))).to_int32(l.clientThreadPk)),created:i,jid:k});if(e==null)throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("offlineThreadingId cannot be null at this point");return a.table("mi_act_mapping_table").put({clientThreadPk:(j||(j=d("I64"))).of_int32(g),jid:f,serverThreadKey:j.of_string(e)}).then(function(){return{chatId:g,created:i,jid:k}})})},"readwrite")}),d("MAWTimedJob").TimedUIJobStarters.waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("getDevices",{ignoreDhash:!1,reason:"creating-1-1-thread",scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},users:new Set().add(d("MAWJids").toUserJid(g))}))])}).then(function(a){a=a[0];return a})}g.call=a}),98);
__d("MAWBridgeTraceEvent",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["ReceivedReceipt","ReceivedSent","FlowEndForFailure","FlowEndForSuccess"]);c=a;f["default"]=c}),66);
__d("LSEncryptedBackupsBackupTenancy",[],(function(a,b,c,d,e,f){a=Object.freeze({PRODUCTION:1,SHADOW:2,OPEN:3});f["default"]=a}),66);
__d("LSWriteToPendingBackupsContext",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(177).add({pk:void 0,pendingBackupTaskId:a[0],persistentId:a[1],actionType:a[2],contentType:a[3],backupStatus:a[4],listKey:a[5],uniqueKey:a[6],sortKey:a[7],echoContent:a[8],lsTraceId:a[9],error:a[13],echoEncodingLatencyNs:a[14]})},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSIssueThreadRemove",["LSArrayGetObjectAt","LSIsEncryptionVersionSecure","LSIssueNewTaskAndGetTaskID","LSLogMebClientEvent.nop","LSWriteToPendingBackupsContext"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][issueThreadRemove] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(b){return d[11]=c.createArray(),d[14]=(d[11].push("Skipping thread remove since EB is disabled. act thread id = "),d[11]),d[14]=(d[11].push(a[0]),d[11]),d[12]=d[11].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ","",d[12]].join("")),c.resolve()},function(a){return d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,1])),d[13].set("stored_procedure","LSEncryptedBackupsIssueThreadRemoveStoredProcedure"),d[13].set("error_message",""),a=[void 0,d[13]],d[2]=a[0],d[3]=a[1],a}]):(f=e.item,c.sequence([function(a){return d[17]=f.backupTenancy,d[16]=f.encryptionVersion,c.i64.neq(void 0,void 0)?c.resolve(d[11]=void 0):c.sequence([function(a){return d[18]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[19]=a[0],a})},function(a){return d[19]?d[28]=(d[18].push(c.i64.cast([0,0])),d[18]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[20]?d[28]=(d[18].push(c.i64.cast([0,2])),d[18]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[21]=a[0],a})},function(a){return d[21]?d[28]=(d[18].push(c.i64.cast([0,3])),d[18]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[22]?d[28]=(d[18].push(c.i64.cast([0,4])),d[18]):0,d[23]=c.createArray(),d[24]=c.i64.of_int32(d[18].length),c.i64.gt(d[24],c.i64.cast([0,0]))?c.loopAsync(d[24],function(a){return d[28]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[18],d[28]).then(function(a){return a=a,d[29]=a[0],d[30]=a[1],a})},function(a){return d[31]=(d[23].push(d[29]),d[23])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[28]=c.createArray(),d[29]=c.i64.of_int32(d[23].length),c.i64.gt(d[29],c.i64.cast([0,0]))?c.loopAsync(d[29],function(a){return d[31]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[23],d[31]).then(function(a){return a=a,d[32]=a[0],d[33]=a[1],a})},function(a){return d[34]=(d[28].push(c.i64.to_string(d[32])),d[28])}])}):c.resolve()},function(a){return d[30]=d[28].join(","),d[25]=d[30]}])},function(a){return d[23].some(function(a){return c.i64.eq(d[16],a)})?d[26]=d[16]:d[26]=void 0,c.i64.neq(d[26],void 0)?d[27]=d[26]:d[27]=void 0,d[11]=d[27]}])},function(e){return c.i64.neq(d[11],void 0)?d[12]=d[11]:d[12]=c.i64.cast([0,0]),c.i64.neq(d[17],void 0)?d[13]=d[17]:d[13]=c.i64.cast([0,1]),c.i64.neq(f.deviceId,void 0)?c.sequence([function(e){return c.i64.eq(d[13],c.i64.cast([0,3]))?d[18]=c.i64.cast([0,4]):d[18]=c.i64.cast([0,0]),d[19]=["eb_upload",":",a[0]].join(""),d[20]=c.i64.of_float(Date.now()),c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),d[19],c.i64.cast([0,50026]),"",void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),c.i64.cast([0,93]),void 0,c.i64.le(c.i64.cast([0,0]),c.i64.cast([0,0]))?c.i64.cast([0,0]):c.i64.add(d[20],c.i64.sub(c.i64.cast([0,0]),c.i64.mod_(d[20],c.i64.cast([0,0])))),c.i64.cast([0,0])).then(function(a){return a=a,d[21]=a[0],a})},function(e){return c.storedProcedure(b("LSWriteToPendingBackupsContext"),d[21],"",c.i64.cast([0,2]),c.i64.cast([0,2]),c.i64.cast([0,1]),a[0],a[0],a[1],void 0,a[3],void 0,void 0,a[2],a[4],void 0,void 0,void 0,void 0,void 0,d[18],!1)},function(b){return c.i64.eq(c.i64.cast([0,2]),c.i64.cast([0,1]))?c.i64.eq(c.i64.cast([0,2]),c.i64.cast([0,1]))?(d[23]=c.createArray(),d[25]=(d[23].push("Successfully issued message backup task. act thread id = "),d[23]),d[25]=(d[23].push(a[0]),d[23]),d[25]=(d[23].push(", otid = "),d[23]),d[25]=(d[23].push(a[0]),d[23]),d[24]=d[23].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ","",d[24]].join("")),c.resolve()):(d[23]=c.createArray(),d[25]=(d[23].push("Successfully issued message remove task. act thread id = "),d[23]),d[25]=(d[23].push(a[0]),d[23]),d[25]=(d[23].push(", otid = "),d[23]),d[25]=(d[23].push(a[0]),d[23]),d[24]=d[23].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ","",d[24]].join("")),c.resolve()):(d[23]=c.createArray(),d[25]=(d[23].push("Successfully issued thread remove task. act thread id = "),d[23]),d[25]=(d[23].push(a[0]),d[23]),d[24]=d[23].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ","",d[24]].join("")),c.resolve())},function(a){return d[22]=new c.Map(),d[22].set("task_id",d[21]),a=[d[22],void 0],d[14]=a[0],d[15]=a[1],a}]):c.sequence([function(b){return d[18]=c.createArray(),d[21]=(d[18].push("Skipping thread remove since EB is disabled. act thread id = "),d[18]),d[21]=(d[18].push(a[0]),d[18]),d[19]=d[18].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ","",d[19]].join("")),c.resolve()},function(a){return d[20]=new c.Map(),d[20].set("error_code",c.i64.cast([0,24])),d[20].set("stored_procedure","LSEncryptedBackupsIssueThreadRemoveStoredProcedure"),d[20].set("error_message",""),a=[void 0,d[20]],d[14]=a[0],d[15]=a[1],a}])},function(a){return a=[d[14],d[15]],d[2]=a[0],d[3]=a[1],a}]))})},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[8]="Finishing execution. Execution time: ",d[9]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ",d[7],d[8],d[7],d[9],d[7],d[10]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[11]=",",d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"issueThreadRemove",[d[8],d[11],d[9],d[11],d[10]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[2],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSIssueThreadRemoveStoredProcedure",["LSIssueThreadRemove"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.actThreadId;d[1]=b.sortKey;d[2]=b.source;d[3]=b.traceId;d[4]=b.error;return c("LSIssueThreadRemove").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSMEBTaskCreationSource",[],(function(a,b,c,d,e,f){a=Object.freeze({UNKNOWN:-1,TEST_ONLY:0,TAM:1,MEM:2,RETROACTIVE_BACKUP:3,TAM_WEB:4,ACT_MESSAGE_DELETE:5,ACT_THREAD_DELETE:6,ACT_UPDATE_ATTACHMENT:7,TAM_PERSISTENCE_TASK:8,TAM_XMA_TOMBSTONE:9,MEM_RECEIVE:10,MEM_SEND:11,MEM_PEER_SYNC:12,MEM_RECEIVE_PROTOBUF:13,MEM_SEND_PROTOBUF:14,MEM_PEER_SYNC_PROTOBUF:15,EB_ADD_DEVICE:21,OPTIMISTIC_THREAD_CREATE_VIA_SHIM:22,ACT_THREAD_INSERT_VIA_SHIM:23,MI_THREAD_INSERT_VIA_SHIM:24,POINT_QUERY_FROM_EB:25,MESSENGER_SEARCH:26,ACT_MESSAGE_RANGE_TASK_HANDLER:27,POINT_QUERY_ON_FULLY_LOADED_THREAD:28,THREAD_CUTOVER:29,HYBRID_THREAD_VERIFY_OR_CREATE_VIA_SHIM:30,BURNER_INTERNAL_LOAD_TESTING_FRAMEWORK:31,THREAD_GALLERY_RESTORE:32,ACT_SURROUNDING_QUERY:33,EB_SNAPSHOT_RESTORE:34,PROTOBUF_RESTORE:39,FTS_INDEX_EB_MESSAGES:40,EB_RESTORE_REPLIED_MESSAGES_AFTER_RANGE_RESTORE:35,REPL_TESTING:36,EB_POINT_QUERY_IN_ACT:37,EB_POINT_QUERY_RETRY_DECRYPTION_FAILURES:38});f["default"]=a}),66);
__d("MAWBridgeDeleteMessagesOfThreadHandler",["I64","LSEncryptedBackupsBackupTenancy","LSFactory","LSIntEnum","LSIssueThreadRemoveStoredProcedure","LSMEBTaskCreationSource","MAWEncryptedBackupUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(b.actionType===2){var e=(yield d("MAWEncryptedBackupUtils").getBackupTenancy(a));if(e==null||!(h||(h=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION)))return;yield c("LSIssueThreadRemoveStoredProcedure")(c("LSFactory")(a),{actThreadId:b.threadId,sortKey:b.ts.toString(),source:(i||(i=d("LSIntEnum"))).ofNumber(c("LSMEBTaskCreationSource").TAM_WEB)})}});return j.apply(this,arguments)}g.call=a}),98);
__d("LSGetThreadTransportIdFromThreadId.nop",["I64","LSResult","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(a,e,f){return(i||(i=b("Promise"))).resolve(c("LSResult")((h||(h=d("I64"))).of_string_opt(f)))};g["default"]=a}),98);
__d("LSIssuePointQueryRestoreTask",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSBinaryToHex.nop","LSCreateDerivedKeys.nop","LSFlushDataTrace.nop","LSGetBlobFromInt64BE.nop","LSGetBlobFromString.nop","LSGetThreadTransportIdFromThreadId.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewTaskAndGetTaskID","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","LSOpeEncrypt.nop","LSTruncateSortKey.nop","gkx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(g){return d.sequence([function(c){return e[0]=d.i64.of_float(Date.now()),function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure] Beginning execution."),a[3]!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),a[3],d.i64.cast([0,2512]),d.i64.cast([0,2]),void 0,void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[1]=a[0],a})},function(a){return e[1]?e[2]=!0:e[2]=!1,e[2]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[12]=d.createArray(),void 0!==void 0?e[13]=(e[12].push(void 0),e[12]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[12],d.i64.cast([0,3]))):d.resolve()},function(f){return c("gkx")("3282")||c("gkx")("3290")?d.sequence([function(c){return function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure] Point query restore v2 is enabled"),d.islc(d.filter(d.db.table(168).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))||!1}),0,d.i64.to_float(d.i64.cast([0,1]))).next().then(function(c,f){var g=c.done;c=c.value;return g?d.sequence([function(c){return e[14]=new d.Map(),e[14].set("error_code",d.i64.cast([0,1])),e[14].set("error_message",""),e[14].set("stored_procedure","issuePointQueryRestoreTask"),e[15]=new d.Map(),e[15].set("act_thread_id",a[0]),e[16]=new d.Map(),e[16].set("restore_context",e[15]),e[16].set("failure",e[14]),d.i64.gt(d.i64.cast([0,0]),d.i64.cast([0,0]))?(e[25]=d.i64.of_float(Date.now()),e[17]=d.i64.add(e[25],d.i64.cast([0,0]))):e[17]=d.i64.cast([0,0]),e[18]=e[16].get("restore_context"),e[16],e[19]=e[16].get("success"),e[16],e[19]!==void 0?(e[25]=e[19].get("message_id"),e[19],e[20]=e[25]):e[20]="",e[21]=e[18].get("act_thread_id"),e[18],e[22]=":",e[23]=d.toJSON(e[16]),d.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),["encrypted_backups_restore",e[22],e[21],e[22],e[20]].join(""),d.i64.cast([0,50035]),e[23],void 0,void 0,d.i64.cast([0,0]),d.i64.cast([0,0]),void 0,void 0,e[17],d.i64.cast([0,0])).then(function(a){return a=a,e[24]=a[0],a})},function(a){return e[12]=e[24]}]):(f=c.item,d.sequence([function(a){return e[20]=f.deviceId,e[19]=f.backupTenancy,e[18]=f.encryptionVersion,d.i64.neq(void 0,void 0)?d.resolve(e[14]=void 0):d.sequence([function(a){return e[21]=d.createArray(),d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,0])).then(function(a){return a=a,e[22]=a[0],a})},function(a){return e[22]?e[31]=(e[21].push(d.i64.cast([0,0])),e[21]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,2])).then(function(a){return a=a,e[23]=a[0],a})},function(a){return e[23]?e[31]=(e[21].push(d.i64.cast([0,2])),e[21]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,3])).then(function(a){return a=a,e[24]=a[0],a})},function(a){return e[24]?e[31]=(e[21].push(d.i64.cast([0,3])),e[21]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,4])).then(function(a){return a=a,e[25]=a[0],a})},function(a){return e[25]?e[31]=(e[21].push(d.i64.cast([0,4])),e[21]):0,e[26]=d.createArray(),e[27]=d.i64.of_int32(e[21].length),d.i64.gt(e[27],d.i64.cast([0,0]))?d.loopAsync(e[27],function(a){return e[31]=a,d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[21],e[31]).then(function(a){return a=a,e[32]=a[0],e[33]=a[1],a})},function(a){return e[34]=(e[26].push(e[32]),e[26])}])}):d.resolve()},function(a){return d.sequence([function(a){return e[31]=d.createArray(),e[32]=d.i64.of_int32(e[26].length),d.i64.gt(e[32],d.i64.cast([0,0]))?d.loopAsync(e[32],function(a){return e[34]=a,d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[26],e[34]).then(function(a){return a=a,e[35]=a[0],e[36]=a[1],a})},function(a){return e[37]=(e[31].push(d.i64.to_string(e[35])),e[31])}])}):d.resolve()},function(a){return e[33]=e[31].join(","),e[28]=e[33]}])},function(a){return e[26].some(function(a){return d.i64.eq(e[18],a)})?e[29]=e[18]:e[29]=void 0,d.i64.neq(e[29],void 0)?e[30]=e[29]:e[30]=void 0,e[14]=e[30]}])},function(c){return d.i64.neq(e[14],void 0)?e[15]=e[14]:e[15]=d.i64.cast([0,0]),d.i64.neq(e[19],void 0)?e[16]=e[19]:e[16]=d.i64.cast([0,1]),d.i64.neq(e[20],void 0)?d.sequence([function(c){return e[21]=new d.Map(),e[21].set("act_thread_id",a[0]),e[21].set("request_id",a[3]),e[21].set("tam_thread_subtype",d.i64.cast([0,0])),e[21].set("source",a[4]),d.nativeOperation(b("LSBase64Encode.nop"),f.ocmfClientStateBlob).then(function(a){return a=a,e[22]=a[0],a})},function(a){return d.nativeOperation(b("LSBase64Encode.nop"),f.mailboxRootKeyBlob).then(function(a){return a=a,e[23]=a[0],a})},function(a){return e[24]=new d.Map(),e[24].set("ocmf_client_state_blob",e[22]==null?"":e[22]),e[24].set("mailbox_root_key",e[23]==null?"":e[23]),e[25]=d.createArray(),d.forEach(d.filter(d.db.table(169).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))}),function(a){a=a.item;return e[41]=(e[25].push(a.epochId),e[25])})},function(a){return e[39]="Queried locally available epochs. Count: ",e[26]=d.i64.of_int32(e[25].length),e[40]=d.i64.to_string(e[26]),e[27]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",e[27],e[39],e[27],e[40]].join("")),d.resolve()},function(c){return e[28]=new d.Map(),e[28].set("device_id",e[20]),e[28].set("raw_tokens",e[24]),e[28].set("locally_available_epochs",e[25]),e[29]=new d.Map(),e[29].set("reference_timestamp",a[2]),e[29].set("device_context",e[28]),e[29].set("message_id",a[1]),e[30]=new d.Map(),e[30].set("restore_context",e[21]),e[30].set("success",e[29]),d.i64.gt(d.i64.cast([0,0]),d.i64.cast([0,0]))?(e[41]=d.i64.of_float(Date.now()),e[31]=d.i64.add(e[41],d.i64.cast([0,0]))):e[31]=d.i64.cast([0,0]),e[32]=e[30].get("restore_context"),e[30],e[33]=e[30].get("success"),e[30],e[33]!==void 0?(e[41]=e[33].get("message_id"),e[33],e[34]=e[41]):e[34]="",e[35]=e[32].get("act_thread_id"),e[32],e[36]=":",e[37]=d.toJSON(e[30]),d.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),["encrypted_backups_restore",e[36],e[35],e[36],e[34]].join(""),d.i64.cast([0,50035]),e[37],void 0,void 0,d.i64.cast([0,0]),d.i64.cast([0,0]),void 0,void 0,e[31],d.i64.cast([0,0])).then(function(a){return a=a,e[38]=a[0],a})},function(a){return e[17]=e[38]}]):d.sequence([function(c){return e[21]=new d.Map(),e[21].set("error_code",d.i64.cast([0,1])),e[21].set("error_message",""),e[21].set("stored_procedure","issuePointQueryRestoreTask"),e[22]=new d.Map(),e[22].set("act_thread_id",a[0]),e[23]=new d.Map(),e[23].set("restore_context",e[22]),e[23].set("failure",e[21]),d.i64.gt(d.i64.cast([0,0]),d.i64.cast([0,0]))?(e[32]=d.i64.of_float(Date.now()),e[24]=d.i64.add(e[32],d.i64.cast([0,0]))):e[24]=d.i64.cast([0,0]),e[25]=e[23].get("restore_context"),e[23],e[26]=e[23].get("success"),e[23],e[26]!==void 0?(e[32]=e[26].get("message_id"),e[26],e[27]=e[32]):e[27]="",e[28]=e[25].get("act_thread_id"),e[25],e[29]=":",e[30]=d.toJSON(e[23]),d.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),["encrypted_backups_restore",e[29],e[28],e[29],e[27]].join(""),d.i64.cast([0,50035]),e[30],void 0,void 0,d.i64.cast([0,0]),d.i64.cast([0,0]),void 0,void 0,e[24],d.i64.cast([0,0])).then(function(a){return a=a,e[31]=a[0],a})},function(a){return e[17]=e[31]}])},function(a){return e[12]=e[17]}]))})},function(a){return e[3]=e[12]}]):d.sequence([function(a){return function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure] Point query restore v2 is disabled"),d.islc(d.filter(d.db.table(168).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))}),0,d.i64.to_float(d.i64.cast([0,1]))).next().then(function(a,c){var f=a.done;a=a.value;return f?(f=[void 0,void 0,void 0,void 0,void 0,d.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,d.i64.cast([0,20])],e[12]=f[0],e[13]=f[1],e[14]=f[2],e[15]=f[3],e[16]=f[4],e[17]=f[5],e[18]=f[6],e[19]=f[7],e[20]=f[8],e[21]=f[9],e[22]=f[10],e[23]=f[11],e[24]=f[12],e[25]=f[13],f):(c=a.item,d.sequence([function(a){return e[32]=c.backupTenancy,e[31]=c.encryptionVersion,d.i64.neq(void 0,void 0)?d.resolve(e[28]=void 0):d.sequence([function(a){return e[33]=d.createArray(),d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,0])).then(function(a){return a=a,e[34]=a[0],a})},function(a){return e[34]?e[43]=(e[33].push(d.i64.cast([0,0])),e[33]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,2])).then(function(a){return a=a,e[35]=a[0],a})},function(a){return e[35]?e[43]=(e[33].push(d.i64.cast([0,2])),e[33]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,3])).then(function(a){return a=a,e[36]=a[0],a})},function(a){return e[36]?e[43]=(e[33].push(d.i64.cast([0,3])),e[33]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,4])).then(function(a){return a=a,e[37]=a[0],a})},function(a){return e[37]?e[43]=(e[33].push(d.i64.cast([0,4])),e[33]):0,e[38]=d.createArray(),e[39]=d.i64.of_int32(e[33].length),d.i64.gt(e[39],d.i64.cast([0,0]))?d.loopAsync(e[39],function(a){return e[43]=a,d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[33],e[43]).then(function(a){return a=a,e[44]=a[0],e[45]=a[1],a})},function(a){return e[46]=(e[38].push(e[44]),e[38])}])}):d.resolve()},function(a){return d.sequence([function(a){return e[43]=d.createArray(),e[44]=d.i64.of_int32(e[38].length),d.i64.gt(e[44],d.i64.cast([0,0]))?d.loopAsync(e[44],function(a){return e[46]=a,d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[38],e[46]).then(function(a){return a=a,e[47]=a[0],e[48]=a[1],a})},function(a){return e[49]=(e[43].push(d.i64.to_string(e[47])),e[43])}])}):d.resolve()},function(a){return e[45]=e[43].join(","),e[40]=e[45]}])},function(a){return e[38].some(function(a){return d.i64.eq(e[31],a)})?e[41]=e[31]:e[41]=void 0,d.i64.neq(e[41],void 0)?e[42]=e[41]:e[42]=void 0,e[28]=e[42]}])},function(a){return d.i64.neq(e[28],void 0)?e[29]=e[28]:e[29]=d.i64.cast([0,0]),d.i64.neq(e[32],void 0)?e[30]=e[32]:e[30]=d.i64.cast([0,1]),a=[c.backupId,c.deviceId,c.mailboxRootKeyBlob,c.ocmfClientStateBlob,e[29],e[30],c.epochAuthPublicKeyBlob,c.epochAuthPrivateKeyBlob,c.devicePublicKeyBlob,c.devicePrivateKeyBlob,c.epochStoragePublicKeyBlob,c.epochStoragePrivateKeyBlob,c.obliviousValidationTokenBlob,c.authorityLevel],e[12]=a[0],e[13]=a[1],e[14]=a[2],e[15]=a[3],e[16]=a[4],e[17]=a[5],e[18]=a[6],e[19]=a[7],e[20]=a[8],e[21]=a[9],e[22]=a[10],e[23]=a[11],e[24]=a[12],e[25]=a[13],a}]))})},function(c){return d.i64.neq(e[12],void 0)?d.sequence([function(c){return d.blobs.neq(e[15],void 0)?d.sequence([function(c){return d.nativeOperation(b("LSGetBlobFromString.nop"),a[0]).then(function(a){return a=a,e[29]=a[0],a})},function(a){return d.nativeOperation(b("LSHmac_v2.nop"),d.blob("dGhyZWFkX2lkX3Njb3Bl"),e[29]).then(function(a){return a=a,e[30]=a[0],a})},function(a){return d.nativeOperation(b("LSOcmfClientMap.nop"),e[15],e[30]).then(function(a){return a=a,e[31]=a[0],a})},function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[31]).then(function(a){return a=a,e[32]=a[0],a})},function(a){return e[53]=e[32]==null?"":e[32],d.nativeOperation(b("LSGetBlobFromString.nop"),d.i64.to_string(e[12])).then(function(a){return a=a,e[33]=a[0],a})},function(a){return d.nativeOperation(b("LSHmac_v2.nop"),d.blob("bWFpbGJveF9pZF9zY29wZQ=="),e[33]).then(function(a){return a=a,e[34]=a[0],a})},function(a){return d.nativeOperation(b("LSOcmfClientMap.nop"),e[15],e[34]).then(function(a){return a=a,e[35]=a[0],a})},function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[35]).then(function(a){return a=a,e[36]=a[0],a})},function(c){return d.nativeOperation(b("LSGetBlobFromString.nop"),a[1]).then(function(a){return a=a,e[37]=a[0],a})},function(a){return d.nativeOperation(b("LSHmac_v2.nop"),d.blob("bWVzc2FnZV9pZF9zY29wZQ=="),e[37]).then(function(a){return a=a,e[38]=a[0],a})},function(a){return d.nativeOperation(b("LSOcmfClientMap.nop"),e[15],e[38]).then(function(a){return a=a,e[39]=a[0],a})},function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[39]).then(function(a){return a=a,e[40]=a[0],a})},function(c){return d.blobs.neq(e[14],void 0)?d.sequence([function(c){return a[2]!==void 0?d.sequence([function(c){return e[57]=d.createArray(),e[63]=(e[57].push(d.i64.cast([0,32])),e[57]),d.nativeOperation(b("LSGetBlobFromString.nop"),["thread_ope_key","_",a[0]].join("")).then(function(a){return a=a,e[58]=a[0],a})},function(a){return d.nativeOperation(b("LSCreateDerivedKeys.nop"),e[58],void 0,e[14],e[57]).then(function(a){return a=a,e[59]=a[0],a})},function(a){return e[59]?e[60]=!1:e[60]=!0,e[60]?d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),e[63]=d.createArray(),void 0!==void 0?e[64]=(e[63].push(void 0),e[63]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","Got null keys while deriving message list OPE key. Returning null blobish",e[63],d.i64.cast([0,3]))},function(a){return e[61]=void 0}]):d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[59],d.i64.cast([0,0])).then(function(a){return a=a,e[63]=a[0],e[64]=a[1],a})},function(a){return e[61]=e[63]}])},function(c){return d.blobs.neq(e[61],void 0)?d.sequence([function(c){return d.nativeOperation(b("LSGetBlobFromInt64BE.nop"),d.i64.from_string(a[2])).then(function(a){return a=a,e[63]=a[0],a})},function(a){return d.nativeOperation(b("LSTruncateSortKey.nop"),e[63]).then(function(a){return a=a,e[64]=a[0],a})},function(a){return d.nativeOperation(b("LSOpeEncrypt.nop"),e[61],e[64],d.i64.cast([0,16])).then(function(a){return a=a,e[65]=a[0],a})},function(a){return d.nativeOperation(b("LSBinaryToHex.nop"),e[65]).then(function(a){return a=a,e[66]=a[0],a})},function(a){return e[62]=e[66]==null?"":e[66]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] OPE key is null"),e[63]=d.createArray(),void 0!==void 0?e[64]=(e[63].push(void 0),e[63]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","OPE key is null",e[63],d.i64.cast([0,3]))},function(a){return e[62]=void 0}])},function(a){return e[56]=e[62]}]):d.resolve(e[56]=void 0)},function(a){return e[41]=e[56]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Mailbox root key is null"),e[56]=d.createArray(),void 0!==void 0?e[57]=(e[56].push(void 0),e[56]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","Mailbox root key is null",e[56],d.i64.cast([0,3]))},function(a){return e[41]=void 0}])},function(c){return a[0]!==void 0?d.sequence([function(c){return d.nativeOperation(b("LSGetThreadTransportIdFromThreadId.nop"),a[0]).then(function(a){return a=a,e[56]=a[0],a})},function(a){return d.i64.neq(e[56],void 0)?d.sequence([function(a){return d.db.table(173).fetch([[[e[56]]],"jid"]).next().then(function(a,b){var c=a.done;a=a.value;return c?e[58]=void 0:(b=a.item,e[58]=b.serverThreadKey)})},function(a){return d.i64.neq(e[58],void 0)?e[60]=d.i64.to_string(e[58]):e[60]=void 0,e[57]=e[60]}]):d.sequence([function(a){return function(a){d.logger(a).warn(a)}("[EncryptedBackups][MEBTableUtils] Failed to get server thread key, wa jid is null"),e[58]=d.createArray(),void 0!==void 0?e[59]=(e[58].push(void 0),e[58]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTableUtils","Failed to get server thread key, wa jid is null",e[58],d.i64.cast([0,2]))},function(a){return e[57]=void 0}])},function(a){return e[42]=e[57]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTableUtils] Failed to get server thread key, thread id is null"),e[56]=d.createArray(),void 0!==void 0?e[57]=(e[56].push(void 0),e[56]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTableUtils","Failed to get server thread key, thread id is null",e[56],d.i64.cast([0,3]))},function(a){return e[42]=void 0}])},function(c){return d.nativeOperation(b("LSGetThreadTransportIdFromThreadId.nop"),a[0]).then(function(a){return a=a,e[43]=a[0],a})},function(c){return a[3]!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),a[3],d.i64.cast([0,3604]),d.i64.cast([0,2]),void 0,void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[44]=a[0],a})},function(a){return e[44]?e[45]=!0:e[45]=!1,e[45]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[56]=d.createArray(),void 0!==void 0?e[57]=(e[56].push(void 0),e[56]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[56],d.i64.cast([0,3]))):d.resolve()},function(a){return e[42]!==void 0?e[46]=e[42]:e[46]="",d.i64.gt(d.i64.cast([0,0]),d.i64.cast([0,0]))?(e[56]=d.i64.of_float(Date.now()),e[47]=d.i64.add(e[56],d.i64.cast([0,0]))):e[47]=d.i64.cast([0,0]),d.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),["encrypted_backups_restore",":",e[46]].join(""),d.i64.cast([0,50015]),"",void 0,void 0,d.i64.cast([0,0]),d.i64.cast([0,0]),void 0,void 0,e[47],d.i64.cast([0,0])).then(function(a){return a=a,e[48]=a[0],a})},function(c){return a[3]!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),a[3],d.i64.cast([0,3601]),d.i64.cast([0,2]),void 0,void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[49]=a[0],a})},function(a){return e[49]?e[50]=!0:e[50]=!1,e[50]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[56]=d.createArray(),void 0!==void 0?e[57]=(e[56].push(void 0),e[56]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[56],d.i64.cast([0,3]))):d.resolve()},function(b){return d.db.table(190).add({taskId:e[48],mailboxPartialId:e[36]==null?"":e[36],listId:e[53],numItems:d.i64.cast([0,1]),contentType:d.i64.cast([0,1]),startSortKey:e[41],traceId:a[3],isPointQuery:!0,messagePartialId:e[40]==null?"":e[40],newerNumItems:d.i64.cast([0,0]),unencryptedSortKey:a[2],messageId:a[1],serverThreadKey:e[42],waThreadId:e[43]})},function(c){return a[3]!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),a[3],d.i64.cast([0,3605]),d.i64.cast([0,2]),void 0,void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[51]=a[0],a})},function(a){return e[51]?e[52]=!0:e[52]=!1,e[52]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[56]=d.createArray(),void 0!==void 0?e[57]=(e[56].push(void 0),e[56]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[56],d.i64.cast([0,3]))):d.resolve()},function(b){return d.db.table(180).add({taskId:e[48],listId:e[53],threadId:a[0]})},function(c){return a[3]!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),a[3],d.i64.cast([0,2513]),d.i64.cast([0,2]),void 0,void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[54]=a[0],a})},function(a){return e[54]?e[55]=!0:e[55]=!1,e[55]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[56]=d.createArray(),void 0!==void 0?e[57]=(e[56].push(void 0),e[56]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[56],d.i64.cast([0,3]))):d.resolve()},function(a){return e[28]=e[48]}]):d.sequence([function(c){return e[29]="Missing ocmf_client_state for IssuePointQueryRestoreTask",e[29]!==void 0?d.sequence([function(c){return e[33]=["[EncryptedBackups][LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure] ","",e[29]].join(""),function(a){d.logger(a).mustfix(a)}(e[33]),e[30]=d.createArray(),a[3]!==void 0?e[34]=(e[30].push(a[3]),e[30]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure",e[29],e[30],d.i64.cast([0,3]))},function(c){return a[3]!==void 0?d.sequence([function(c){return a[3]!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),a[3],d.i64.cast([0,85]),d.i64.cast([0,2]),e[33],void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[34]=a[0],a})},function(a){return e[34]?e[35]=!0:e[35]=!1,e[35]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[36]=d.createArray(),void 0!==void 0?e[37]=(e[36].push(void 0),e[36]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[36],d.i64.cast([0,3]))):d.resolve()}]):d.resolve()},function(c){return a[3]!==void 0?d.nativeOperation(b("LSFlushDataTrace.nop"),a[3]):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[31]=a[0],a})},function(a){return e[31]?e[32]=!0:e[32]=!1,e[32]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[34]=d.createArray(),void 0!==void 0?e[35]=(e[34].push(void 0),e[34]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[34],d.i64.cast([0,3]))):d.resolve()}]):d.sequence([function(c){return a[3]!==void 0?d.sequence([function(c){return a[3]!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),a[3],d.i64.cast([0,85]),d.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure] ","",""].join(""),void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[32]=a[0],a})},function(a){return e[32]?e[33]=!0:e[33]=!1,e[33]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[34]=d.createArray(),void 0!==void 0?e[35]=(e[34].push(void 0),e[34]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[34],d.i64.cast([0,3]))):d.resolve()}]):d.resolve()},function(c){return a[3]!==void 0?d.nativeOperation(b("LSFlushDataTrace.nop"),a[3]):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[30]=a[0],a})},function(a){return e[30]?e[31]=!0:e[31]=!1,e[31]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[32]=d.createArray(),void 0!==void 0?e[33]=(e[32].push(void 0),e[32]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[32],d.i64.cast([0,3]))):d.resolve()}])},function(a){return e[28]=d.i64.cast([-1,4294967295])}])},function(a){return e[27]=e[28]}]):d.sequence([function(c){return e[28]="Missing backup_id for IssuePointQueryRestoreTask",e[28]!==void 0?d.sequence([function(c){return e[32]=["[EncryptedBackups][LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure] ","",e[28]].join(""),function(a){d.logger(a).mustfix(a)}(e[32]),e[29]=d.createArray(),a[3]!==void 0?e[33]=(e[29].push(a[3]),e[29]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure",e[28],e[29],d.i64.cast([0,3]))},function(c){return a[3]!==void 0?d.sequence([function(c){return a[3]!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),a[3],d.i64.cast([0,85]),d.i64.cast([0,2]),e[32],void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[33]=a[0],a})},function(a){return e[33]?e[34]=!0:e[34]=!1,e[34]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[35]=d.createArray(),void 0!==void 0?e[36]=(e[35].push(void 0),e[35]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[35],d.i64.cast([0,3]))):d.resolve()}]):d.resolve()},function(c){return a[3]!==void 0?d.nativeOperation(b("LSFlushDataTrace.nop"),a[3]):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[30]=a[0],a})},function(a){return e[30]?e[31]=!0:e[31]=!1,e[31]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[33]=d.createArray(),void 0!==void 0?e[34]=(e[33].push(void 0),e[33]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[33],d.i64.cast([0,3]))):d.resolve()}]):d.sequence([function(c){return a[3]!==void 0?d.sequence([function(c){return a[3]!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),a[3],d.i64.cast([0,85]),d.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure] ","",""].join(""),void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[31]=a[0],a})},function(a){return e[31]?e[32]=!0:e[32]=!1,e[32]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[33]=d.createArray(),void 0!==void 0?e[34]=(e[33].push(void 0),e[33]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[33],d.i64.cast([0,3]))):d.resolve()}]):d.resolve()},function(c){return a[3]!==void 0?d.nativeOperation(b("LSFlushDataTrace.nop"),a[3]):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[29]=a[0],a})},function(a){return e[29]?e[30]=!0:e[30]=!1,e[30]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[31]=d.createArray(),void 0!==void 0?e[32]=(e[31].push(void 0),e[31]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[31],d.i64.cast([0,3]))):d.resolve()}])},function(a){return e[27]=d.i64.cast([-1,4294967295])}])},function(a){return e[3]=e[27]}])},function(c){return a[3]!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),a[3],d.i64.cast([0,2513]),d.i64.cast([0,2]),void 0,void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[4]=a[0],a})},function(a){return e[4]?e[5]=!0:e[5]=!1,e[5]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[12]=d.createArray(),void 0!==void 0?e[13]=(e[12].push(void 0),e[12]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[12],d.i64.cast([0,3]))):d.resolve()},function(a){return e[6]=d.i64.of_float(Date.now()),e[7]=d.i64.random(),e[9]="Finishing execution. Execution time: ",e[10]=d.i64.to_string(d.i64.sub(e[6],e[0])),e[11]=" ms",e[8]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure] ",e[8],e[9],e[8],e[10],e[8],e[11]].join("")),d.i64.eq(d.i64.mod_(e[7],d.i64.cast([0,100])),d.i64.cast([0,0]))?(e[12]=",",e[13]=d.createArray(),void 0!==void 0?e[14]=(e[13].push(void 0),e[13]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure",[e[9],e[12],e[10],e[12],e[11]].join(""),e[13],d.i64.cast([0,4]))):d.resolve()},function(a){return f[0]=e[3]}])},function(a){return d.resolve(f)}])}d=a;g["default"]=d}),98);
__d("LSIssuePointQueryRestoreTaskStoredProcedure",["LSIssuePointQueryRestoreTask"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.threadId;d[1]=b.messageId;d[2]=b.startSortKey;d[3]=b.traceId;d[4]=b.source;return c("LSIssuePointQueryRestoreTask").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("WAHashStringToNumber",[],(function(a,b,c,d,e,f){function a(a){var b=0;for(var c=0;c<a.length;c++){var d=a.charCodeAt(c);b=(b<<5)-b+d;b|=0}return Math.abs(b)}f.hashStringToNumber=a}),66);
__d("MAWBridgeIssuePointQueryHandler",["I64","LSEncryptedBackupsBackupTenancy","LSFactory","LSIntEnum","LSIssuePointQueryRestoreTaskStoredProcedure","LSMEBTaskCreationSource","MAWEncryptedBackupUtils","Promise","QuickPerformanceLogger","WAHashStringToNumber","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function a(a,e){return d("MAWEncryptedBackupUtils").getBackupTenancy(a).then(function(f){if(f==null)return(k||(k=b("Promise"))).resolve();if(!(i||(i=d("I64"))).equal(f,(j||(j=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION)))return(k||(k=b("Promise"))).resolve();f=d("WAHashStringToNumber").hashStringToNumber(e.messageId);var g=f.toString(),l=e.startSortKey,m=e.taskSource===c("LSMEBTaskCreationSource").EB_POINT_QUERY_RETRY_DECRYPTION_FAILURES?c("LSMEBTaskCreationSource").EB_POINT_QUERY_RETRY_DECRYPTION_FAILURES:c("LSMEBTaskCreationSource").EB_POINT_QUERY_IN_ACT;m===c("LSMEBTaskCreationSource").EB_POINT_QUERY_RETRY_DECRYPTION_FAILURES&&((h||(h=c("QuickPerformanceLogger"))).markerStart(c("qpl")._(1056840931,"814"),f),h.markerPoint(c("qpl")._(1056840931,"814"),"eb_point_restore_begin",{data:{"int":{msgId:f},string:{jid:e.jid}},instanceKey:f}));if(l!=null)return c("LSIssuePointQueryRestoreTaskStoredProcedure")(c("LSFactory")(a),{messageId:e.messageId,source:(j||(j=d("LSIntEnum"))).ofNumber(m),startSortKey:l,threadId:e.threadId,traceId:g}).then(function(){});else return c("LSIssuePointQueryRestoreTaskStoredProcedure")(c("LSFactory")(a),{messageId:e.messageId,source:(j||(j=d("LSIntEnum"))).ofNumber(m),threadId:e.threadId,traceId:g}).then(function(){})})}g.call=a}),98);
__d("ArmadilloDataTraceCheckPoint",["I64"],(function(a,b,c,d,e,f,g){"use strict";var h;a=(h||(h=d("I64"))).of_string("63");b=h.of_string("65");c=h.of_string("98");e=h.of_string("504");f=h.of_string("1000");d=h.of_string("1001");var i=h.of_string("1204"),j=h.of_string("1210"),k=h.of_string("1224"),l=h.of_string("1234"),m=h.of_string("1225"),n=h.of_string("2220");g.traceGroupMessage=a;g.armadilloActMessageSend=b;g.traceCreated=c;g.richMediaMediaSendAttachmentType=e;g.traceTextMessage=f;g.traceMediaMessage=d;g.advancedCryptoMEMSendTaskComplete=i;g.deliveryReceiptReceived=j;g.advancedCryptoMEMEncryptionDeviceCount=k;g.advancedCryptoGroupDualSend=l;g.advancedCryptoDualSend=m;g.armadilloTlcControlOpenThread=n}),98);
__d("MAWBridgeTraceUtils",["I64","Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,c,e){return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.table("data_trace_meta")).filter(function(a){var b=a.contextThree;if(b!=null&&c===b&&(i||(i=d("I64"))).equal(a.traceType,e))return a.shouldFlush===!1;else return!1})).then(function(a){if(a.length!==0)return(h||(h=b("Promise"))).resolve(a[0].traceId);else return(h||(h=b("Promise"))).resolve()})}g.getTraceId=a}),98);
__d("MAWBridgeStartTraceHandler",["ArmadilloDataTraceCheckPoint","ArmadilloDataTraceType","I64","LSAppendDataTraceAddonStoredProcedure","LSDataTraceTag","LSFactory","LSRequestId","MAWAckLevel","MAWBridgeTraceUtils","MAWMsg","MAWTimeUtils","Promise","gkx","killswitch","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b,e){return a.table("data_trace_meta").add({contextOne:void 0,contextThree:b.externalId,contextTwo:void 0,foregroundTimestampMs:(i||(i=d("I64"))).zero,initTimestampMs:d("MAWTimeUtils").toTimestamp(b.ts),predefinedId:void 0,shouldFlush:!1,traceId:e,traceType:b.traceType}).then(function(){return c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:d("ArmadilloDataTraceCheckPoint").traceCreated,dataTraceId:e,syncChannel:(i||(i=d("I64"))).neg_one})}).then(function(){var f;if(b.threadKey==null||!c("gkx")("2517"))return;return c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:d("ArmadilloDataTraceCheckPoint").armadilloTlcControlOpenThread,dataTraceId:e,syncChannel:(i||(i=d("I64"))).neg_one,tags:(f=b.threadKey)!=null?f:void 0})})}function a(a,e){if(c("killswitch")("MESSENGER_WEB_DATA_TRACE_ID"))return(h||(h=b("Promise"))).resolve();var f=e.ack,g=e.traceType;return f===d("MAWAckLevel").ACK.clock?d("MAWBridgeTraceUtils").getTraceId(a,e.externalId,e.traceType).then(function(f){if(f!=null)return;var k=c("LSRequestId").generate();if((i||(i=d("I64"))).equal(g,d("ArmadilloDataTraceType").armadilloMessageSend))return j(a,e,k).then(function(){var b=e.threadType;if(b==="User")return;return c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:d("ArmadilloDataTraceCheckPoint").traceGroupMessage,dataTraceId:k,syncChannel:(i||(i=d("I64"))).neg_one})}).then(function(){if(e.isFirstMsg)return c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:d("ArmadilloDataTraceCheckPoint").armadilloActMessageSend,dataTraceId:k,syncChannel:(i||(i=d("I64"))).neg_one,tags:"first_msg=1"})}).then(function(){var f=e.type_;f=f===d("MAWMsg").text?d("ArmadilloDataTraceCheckPoint").traceTextMessage:f===d("MAWMsg").ptt||f===d("MAWMsg").image||f===d("MAWMsg").video||f===d("MAWMsg").gif?d("ArmadilloDataTraceCheckPoint").traceMediaMessage:void 0;if(f==null)return(h||(h=b("Promise"))).resolve(f);c("promiseDone")(c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:f,dataTraceId:k,syncChannel:(i||(i=d("I64"))).neg_one}));return(h||(h=b("Promise"))).resolve(f)}).then(function(b){if(b==null)return;if(!(i||(i=d("I64"))).equal(b,d("ArmadilloDataTraceCheckPoint").traceMediaMessage))return;b=e.type_;b=b===d("MAWMsg").image?d("LSDataTraceTag").image:b===d("MAWMsg").ptt?d("LSDataTraceTag").audio:b===d("MAWMsg").video?d("LSDataTraceTag").video:b===d("MAWMsg").gif?d("LSDataTraceTag").animatedImage:d("LSDataTraceTag").none;return c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:d("ArmadilloDataTraceCheckPoint").richMediaMediaSendAttachmentType,dataTraceId:k,syncChannel:(i||(i=d("I64"))).neg_one,tags:String(b)})});else return j(a,e,k)}):(h||(h=b("Promise"))).resolve()}g.call=a}),98);
__d("MAWMainTraceUtils",["I64","LSRequestId","Promise","killswitch"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(){return c("LSRequestId").generate()}function e(a,e,f,g,j,k,l){if(c("killswitch")("MESSENGER_WEB_DATA_TRACE_ID"))return(i||(i=b("Promise"))).resolve();else return a.table("data_trace_meta").add({contextOne:j,contextThree:l,contextTwo:k,foregroundTimestampMs:(h||(h=d("I64"))).zero,initTimestampMs:e,predefinedId:void 0,shouldFlush:!1,traceId:f,traceType:g})}g.createTraceId=a;g.startTraceWithTxn=e}),98);
__d("MAWBridgeStartTraceWithTraceIdHandler",["MAWMainTraceUtils","MAWTimeUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMainTraceUtils").startTraceWithTxn(a,d("MAWTimeUtils").toTimestamp(d("WATimeUtils").unixTime()),b.traceId,b.traceType,void 0,void 0,b.traceContext)}g.call=a}),98);
__d("MAWBridgeTraceRecordCheckpointHandler",["I64","LSAppendDataTraceAddonStoredProcedure","LSFactory","LSFlushDataTrace.nop"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var e=b.checkPointId,f=b.dataTraceId,g=b.errorMessage,i=b.tags;return c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:e,dataTraceId:f,errorMessage:g,syncChannel:(h||(h=d("I64"))).neg_one,tags:i}).then(function(){if(b.shouldFlush)return c("LSFlushDataTrace.nop")(a,0,f)})}g.call=a}),98);
__d("EncryptedBackupsDYIPasswordReauthDialog.entrypoint",["EncryptedBackupsDYIPasswordReauthDialogQuery$Parameters","JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";a=c("JSResourceForInteraction")("EncryptedBackupsDYIPasswordReauthDialog.react").__setRef("EncryptedBackupsDYIPasswordReauthDialog.entrypoint");b={getPreloadProps:function(){return{queries:{queryReference:{parameters:c("EncryptedBackupsDYIPasswordReauthDialogQuery$Parameters"),variables:{}}}}},root:a};g["default"]=b}),98);
__d("useEncryptedBackupsDYIPasswordReauthDialog",["EncryptedBackupsDYIPasswordReauthDialog.entrypoint","useMWXEntryPointDialog"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.onConfirm;a=c("useMWXEntryPointDialog")(c("EncryptedBackupsDYIPasswordReauthDialog.entrypoint"),{});var d=a[0];return function(){return d({onConfirm:b})}}g["default"]=a}),98);
__d("useMAWDYIRestoreThreadsFromOccamadillo",["MAWEBFrontendQPLLogger","react","requireDeferred","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(i||d("react")).useCallback,k=c("requireDeferred")("MAWDYIRestoreThreadsFromOccamadillo").__setRef("useMAWDYIRestoreThreadsFromOccamadillo");function a(){var a=(h||(h=c("useReStore")))();return j(function(){var b=d("MAWEBFrontendQPLLogger").startDyiQplE2EUserFlow();k.onReady(function(c){return c.call(a,b)})},[a])}g["default"]=a}),98);
__d("useEncryptedBackupsDYIDownloader",["MAWBridgeSendAndReceive","MAWEBFrontendQPLLogger","Promise","asyncToGeneratorRuntime","promiseDone","requireDeferred","useEncryptedBackupsDYIPasswordReauthDialog","useMAWDYIRestoreThreadsFromOccamadillo"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("file-saver").__setRef("useEncryptedBackupsDYIDownloader"),j=c("requireDeferred")("jszip").__setRef("useEncryptedBackupsDYIDownloader");function k(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=(yield d("MAWBridgeSendAndReceive").sendAndReceive("backend","getAllThreadsAsJson")),e={};Object.keys(c).forEach(function(b){var d=c[b],f=d.messages,g=d.participants;d=d.stickers;f=f.map(function(a){var b=a.common;a.jsonType;a=babelHelpers.objectWithoutPropertiesLoose(a,["common","jsonType"]);return babelHelpers["extends"]({},b,a)});a.file("inbox/"+b+"/messages.json",JSON.stringify({messages:f,participants:g},null,4));["photos","videos","audio","gifs"].forEach(function(d){var e=c[b][d];Object.entries(e).forEach(function(c){var e=c[0];c=c[1];a.file("inbox/"+b+"/"+d+"/"+e,c)})});Object.entries(d).forEach(function(a){var b=a[0];a=a[1];e[b]=a})});Object.entries(e).forEach(function(b){var c=b[0];b=b[1];a.file("stickers_used/"+c,b)});return(h||(h=b("Promise"))).resolve(a)});return l.apply(this,arguments)}function m(a,b){i.onReadyImmediately(function(c){c=c.saveAs;c(b,a)})}function a(a){j.onReady(function(b){b=b();c("promiseDone")(k(b).then(function(a){return a.generateAsync({compression:"DEFLATE",compressionOptions:{level:6},type:"blob"})}).then(function(b){m("messages.zip",b),d("MAWEBFrontendQPLLogger").endDyiE2ECompleted(a,!0)}))})}function e(){return c("useMAWDYIRestoreThreadsFromOccamadillo")()}function f(){return c("useEncryptedBackupsDYIPasswordReauthDialog")({onConfirm:c("useMAWDYIRestoreThreadsFromOccamadillo")()})}g.createFileAndDownload=a;g.useEncryptedBackupsDYIDownloader=e;g.useEncryptedBackupsDYIDownloaderWithReauthDialog=f}),98);
__d("MAWBridgeUpdateDyiStatus",["I64","LSIntEnum","MAWEBFrontendQPLLogger","useEncryptedBackupsDYIDownloader"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b){return a.table("encrypted_backups_dyi_backup_restore_status").put({currentStatus:b,pk:(h||(h=d("I64"))).zero})}function a(a,b){var c=b.qplInstanceKeyE2E;b=b.status;d("MAWEBFrontendQPLLogger").logDyiE2EDyiBackupRestoreCompleted(c,b);d("useEncryptedBackupsDYIDownloader").createFileAndDownload(c);if(b)return j(a,(i||(i=d("LSIntEnum"))).ofNumber(1));else return j(a,(i||(i=d("LSIntEnum"))).ofNumber(2))}g.call=a}),98);
__d("MAWBridgeUpdateTraceHandler",["ArmadilloDataTraceCheckPoint","I64","LSAppendDataTraceAddonStoredProcedure","LSDataTraceCheckPoint","LSFactory","LSIntEnum","MAWBridgeTraceEvent","Promise","ReQL","emptyFunction","killswitch","updateAndFlushLSDataTrace"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a,e,f){return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.table("data_trace_meta")).filter(function(a){var b=a.contextThree;if(b!=null&&e.externalIds.includes(b)&&(j||(j=d("I64"))).equal(a.traceType,e.traceType))return a.shouldFlush===!1;else return!1})).then(function(g){var i=[];return g.reduce(function(b,g){return b.then(function(){i.push(g.traceId);var b=e.errorMessage;if(b!=null)return c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:f,dataTraceId:g.traceId,errorMessage:b,syncChannel:(j||(j=d("I64"))).neg_one});else return c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:f,dataTraceId:g.traceId,syncChannel:(j||(j=d("I64"))).neg_one})})},(h||(h=b("Promise"))).resolve()).then(function(){return i})})}function l(a,d){return d.reduce(function(b,d){return b.then(function(){return c("updateAndFlushLSDataTrace")(a,d)})},(h||(h=b("Promise"))).resolve())}function a(a,e){if(c("killswitch")("MESSENGER_WEB_DATA_TRACE_ID"))return(h||(h=b("Promise"))).resolve();var f=e.event;if(f===c("MAWBridgeTraceEvent").ReceivedReceipt)return k(a,e,d("ArmadilloDataTraceCheckPoint").deliveryReceiptReceived).then(function(b){return l(a,b)});else if(f===c("MAWBridgeTraceEvent").ReceivedSent)return k(a,e,d("ArmadilloDataTraceCheckPoint").advancedCryptoMEMSendTaskComplete).then(c("emptyFunction"));else if(f===c("MAWBridgeTraceEvent").FlowEndForFailure)return k(a,e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_FOR_FAILURE)).then(function(b){return l(a,b)});else if(f===c("MAWBridgeTraceEvent").FlowEndForSuccess)return k(a,e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_AND_FLUSH)).then(function(b){return l(a,b)});else return(h||(h=b("Promise"))).resolve()}g.call=a}),98);
__d("LSSerializeAttachmentBackupPayload",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(a){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][serializeAttachmentBackupPayload] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[2]=c.i64.of_float(Date.now()),d[3]=c.i64.random(),d[5]="Finishing execution. Execution time: ",d[6]=c.i64.to_string(c.i64.sub(d[2],d[0])),d[7]=" ms",d[4]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][serializeAttachmentBackupPayload] ",d[4],d[5],d[4],d[6],d[4],d[7]].join("")),c.i64.eq(c.i64.mod_(d[3],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[8]=",",d[9]=c.createArray(),void 0!==void 0?d[10]=(d[9].push(void 0),d[9]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"serializeAttachmentBackupPayload",[d[5],d[8],d[6],d[8],d[7]].join(""),d[9],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[void 0,void 0],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSWriteToPendingProtobufBackupsContext",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(305).add({pk:void 0,pendingBackupTaskId:a[0],actThreadId:a[1],toplevelOfflineThreadingId:a[2],messageTimestampMs:a[4],backupAction:a[5],supplementalKey:a[3],attachmentPayload:a[6]})},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSIssueMessageBackup",["LSArrayGetObjectAt","LSIsEncryptionVersionSecure","LSIssueNewTaskAndGetTaskID","LSLogMebClientEvent.nop","LSSerializeAttachmentBackupPayload","LSWriteToPendingBackupsContext","LSWriteToPendingProtobufBackupsContext"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][issueMessageBackup] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(b){return d[11]=c.createArray(),d[14]=(d[11].push("Skipping the message upload since EB is disabled. act thread id = "),d[11]),d[14]=(d[11].push(a[0]),d[11]),d[14]=(d[11].push(", otid = "),d[11]),d[14]=(d[11].push(a[1]),d[11]),d[12]=d[11].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageBackup] ","",d[12]].join("")),c.resolve()},function(a){return d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,1])),d[13].set("stored_procedure","LSEncryptedBackupsIssueMessageBackupStoredProcedure"),d[13].set("error_message",""),a=[void 0,d[13]],d[2]=a[0],d[3]=a[1],a}]):(f=e.item,c.sequence([function(a){return d[17]=f.backupTenancy,d[16]=f.encryptionVersion,c.i64.neq(void 0,void 0)?c.resolve(d[11]=void 0):c.sequence([function(a){return d[18]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[19]=a[0],a})},function(a){return d[19]?d[28]=(d[18].push(c.i64.cast([0,0])),d[18]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[20]?d[28]=(d[18].push(c.i64.cast([0,2])),d[18]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[21]=a[0],a})},function(a){return d[21]?d[28]=(d[18].push(c.i64.cast([0,3])),d[18]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[22]?d[28]=(d[18].push(c.i64.cast([0,4])),d[18]):0,d[23]=c.createArray(),d[24]=c.i64.of_int32(d[18].length),c.i64.gt(d[24],c.i64.cast([0,0]))?c.loopAsync(d[24],function(a){return d[28]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[18],d[28]).then(function(a){return a=a,d[29]=a[0],d[30]=a[1],a})},function(a){return d[31]=(d[23].push(d[29]),d[23])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[28]=c.createArray(),d[29]=c.i64.of_int32(d[23].length),c.i64.gt(d[29],c.i64.cast([0,0]))?c.loopAsync(d[29],function(a){return d[31]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[23],d[31]).then(function(a){return a=a,d[32]=a[0],d[33]=a[1],a})},function(a){return d[34]=(d[28].push(c.i64.to_string(d[32])),d[28])}])}):c.resolve()},function(a){return d[30]=d[28].join(","),d[25]=d[30]}])},function(a){return d[23].some(function(a){return c.i64.eq(d[16],a)})?d[26]=d[16]:d[26]=void 0,c.i64.neq(d[26],void 0)?d[27]=d[26]:d[27]=void 0,d[11]=d[27]}])},function(e){return c.i64.neq(d[11],void 0)?d[12]=d[11]:d[12]=c.i64.cast([0,0]),c.i64.neq(d[17],void 0)?d[13]=d[17]:d[13]=c.i64.cast([0,1]),c.i64.neq(f.deviceId,void 0)?c.sequence([function(a){return c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueMessageBackupStoredProcedure] Skip processing attachments as not enabled."),a=[void 0,void 0],d[18]=a[0],d[19]=a[1],a))},function(e){return c.i64.eq(d[13],c.i64.cast([0,3]))?d[20]=c.i64.cast([0,4]):d[20]=c.i64.cast([0,0]),d[21]=["eb_upload",":",a[0]].join(""),d[22]=c.i64.of_float(Date.now()),c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),d[21],c.i64.cast([0,50026]),"",void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),c.i64.cast([0,93]),void 0,c.i64.le(c.i64.cast([0,0]),c.i64.cast([0,0]))?c.i64.cast([0,0]):c.i64.add(d[22],c.i64.sub(c.i64.cast([0,0]),c.i64.mod_(d[22],c.i64.cast([0,0])))),c.i64.cast([0,0])).then(function(a){return a=a,d[23]=a[0],a})},function(e){return c.storedProcedure(b("LSWriteToPendingBackupsContext"),d[23],"",c.i64.cast([0,1]),c.i64.cast([0,1]),c.i64.cast([0,1]),a[0],a[1],c.i64.to_string(c.i64.add(c.i64.mul(c.i64.div(a[2],c.i64.cast([0,1e3])),c.i64.cast([0,1e3])),c.i64.div(c.i64.mod_(c.i64.and_(c.i64.asr_(c.i64.from_string(a[1]),c.i64.to_int32(c.i64.cast([0,22]))),c.i64.cast([511,4294967295])),c.i64.cast([0,1e5])),c.i64.cast([0,100])))),a[4],a[5],void 0,void 0,a[3],a[6],a[7],a[8],void 0,d[18],d[19],d[20],a[12])},function(b){return c.i64.eq(c.i64.cast([0,1]),c.i64.cast([0,1]))?c.i64.eq(c.i64.cast([0,1]),c.i64.cast([0,1]))?(d[25]=c.createArray(),d[27]=(d[25].push("Successfully issued message backup task. act thread id = "),d[25]),d[27]=(d[25].push(a[0]),d[25]),d[27]=(d[25].push(", otid = "),d[25]),d[27]=(d[25].push(a[1]),d[25]),d[26]=d[25].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageBackup] ","",d[26]].join("")),c.resolve()):(d[25]=c.createArray(),d[27]=(d[25].push("Successfully issued message remove task. act thread id = "),d[25]),d[27]=(d[25].push(a[0]),d[25]),d[27]=(d[25].push(", otid = "),d[25]),d[27]=(d[25].push(a[1]),d[25]),d[26]=d[25].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageBackup] ","",d[26]].join("")),c.resolve()):(d[25]=c.createArray(),d[27]=(d[25].push("Successfully issued thread remove task. act thread id = "),d[25]),d[27]=(d[25].push(a[0]),d[25]),d[26]=d[25].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageBackup] ","",d[26]].join("")),c.resolve())},function(e){return a[9]!==void 0?(d[25]=a[9].get("act_thread_id"),a[9],d[26]=a[9].get("backup_action"),a[9],d[27]=a[9].get("toplevel_offline_threading_id"),a[9],d[28]=a[9].get("message_timestamp_ms"),a[9],d[29]=a[9].get("supplemental_key"),a[9],d[30]=a[9].get("attachment_payload"),a[9],c.storedProcedure(b("LSWriteToPendingProtobufBackupsContext"),d[23],d[25],d[27],d[29],d[28],d[26],d[30])):c.resolve()},function(a){return d[24]=new c.Map(),d[24].set("task_id",d[23]),a=[d[24],void 0],d[14]=a[0],d[15]=a[1],a}]):c.sequence([function(b){return d[18]=c.createArray(),d[21]=(d[18].push("Skipping the message upload since EB is disabled. act thread id = "),d[18]),d[21]=(d[18].push(a[0]),d[18]),d[21]=(d[18].push(", otid = "),d[18]),d[21]=(d[18].push(a[1]),d[18]),d[19]=d[18].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageBackup] ","",d[19]].join("")),c.resolve()},function(a){return d[20]=new c.Map(),d[20].set("error_code",c.i64.cast([0,24])),d[20].set("stored_procedure","LSEncryptedBackupsIssueMessageBackupStoredProcedure"),d[20].set("error_message",""),a=[void 0,d[20]],d[14]=a[0],d[15]=a[1],a}])},function(a){return a=[d[14],d[15]],d[2]=a[0],d[3]=a[1],a}]))})},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[8]="Finishing execution. Execution time: ",d[9]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageBackup] ",d[7],d[8],d[7],d[9],d[7],d[10]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[11]=",",d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"issueMessageBackup",[d[8],d[11],d[9],d[11],d[10]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[2],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}c=a;g["default"]=c}),98);
__d("LSIssueMessageBackupStoredProcedure",["LSIssueMessageBackup"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.actThreadId;d[1]=b.otid;d[2]=b.authoritativeTs;d[3]=b.source;d[4]=b.echoDocument;d[5]=b.traceId;d[6]=b.error;d[7]=b.echoEncodingLatencyNs;d[8]=b.errorMessage;d[9]=b.protobufBackupContext;d[10]=b.tamThreadSubtype;d[11]=b.attachmentBackupContext;d[12]=b.isInstamadillo;return c("LSIssueMessageBackup").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSIssueMessageRemove",["LSArrayGetObjectAt","LSIsEncryptionVersionSecure","LSIssueNewTaskAndGetTaskID","LSLogMebClientEvent.nop","LSWriteToPendingBackupsContext"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][issueMessageRemove] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(b){return d[11]=c.createArray(),d[14]=(d[11].push("Skipping message upload since EB is disabled. act thread id = "),d[11]),d[14]=(d[11].push(a[0]),d[11]),d[14]=(d[11].push(", otid = "),d[11]),d[14]=(d[11].push(a[1]),d[11]),d[12]=d[11].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageRemove] ","",d[12]].join("")),c.resolve()},function(a){return d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,1])),d[13].set("stored_procedure","LSEncryptedBackupsIssueMessageRemoveStoredProcedure"),d[13].set("error_message",""),a=[void 0,d[13]],d[2]=a[0],d[3]=a[1],a}]):(f=e.item,c.sequence([function(a){return d[17]=f.backupTenancy,d[16]=f.encryptionVersion,c.i64.neq(void 0,void 0)?c.resolve(d[11]=void 0):c.sequence([function(a){return d[18]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[19]=a[0],a})},function(a){return d[19]?d[28]=(d[18].push(c.i64.cast([0,0])),d[18]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[20]?d[28]=(d[18].push(c.i64.cast([0,2])),d[18]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[21]=a[0],a})},function(a){return d[21]?d[28]=(d[18].push(c.i64.cast([0,3])),d[18]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[22]?d[28]=(d[18].push(c.i64.cast([0,4])),d[18]):0,d[23]=c.createArray(),d[24]=c.i64.of_int32(d[18].length),c.i64.gt(d[24],c.i64.cast([0,0]))?c.loopAsync(d[24],function(a){return d[28]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[18],d[28]).then(function(a){return a=a,d[29]=a[0],d[30]=a[1],a})},function(a){return d[31]=(d[23].push(d[29]),d[23])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[28]=c.createArray(),d[29]=c.i64.of_int32(d[23].length),c.i64.gt(d[29],c.i64.cast([0,0]))?c.loopAsync(d[29],function(a){return d[31]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[23],d[31]).then(function(a){return a=a,d[32]=a[0],d[33]=a[1],a})},function(a){return d[34]=(d[28].push(c.i64.to_string(d[32])),d[28])}])}):c.resolve()},function(a){return d[30]=d[28].join(","),d[25]=d[30]}])},function(a){return d[23].some(function(a){return c.i64.eq(d[16],a)})?d[26]=d[16]:d[26]=void 0,c.i64.neq(d[26],void 0)?d[27]=d[26]:d[27]=void 0,d[11]=d[27]}])},function(e){return c.i64.neq(d[11],void 0)?d[12]=d[11]:d[12]=c.i64.cast([0,0]),c.i64.neq(d[17],void 0)?d[13]=d[17]:d[13]=c.i64.cast([0,1]),c.i64.neq(f.deviceId,void 0)?c.sequence([function(e){return c.i64.eq(d[13],c.i64.cast([0,3]))?d[18]=c.i64.cast([0,4]):d[18]=c.i64.cast([0,0]),d[19]=["eb_upload",":",a[0]].join(""),d[20]=c.i64.of_float(Date.now()),c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),d[19],c.i64.cast([0,50026]),"",void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),c.i64.cast([0,93]),void 0,c.i64.le(c.i64.cast([0,0]),c.i64.cast([0,0]))?c.i64.cast([0,0]):c.i64.add(d[20],c.i64.sub(c.i64.cast([0,0]),c.i64.mod_(d[20],c.i64.cast([0,0])))),c.i64.cast([0,0])).then(function(a){return a=a,d[21]=a[0],a})},function(e){return c.storedProcedure(b("LSWriteToPendingBackupsContext"),d[21],"",c.i64.cast([0,2]),c.i64.cast([0,1]),c.i64.cast([0,1]),a[0],a[1],c.i64.to_string(c.i64.add(c.i64.mul(c.i64.div(a[2],c.i64.cast([0,1e3])),c.i64.cast([0,1e3])),c.i64.div(c.i64.mod_(c.i64.and_(c.i64.asr_(c.i64.from_string(a[1]),c.i64.to_int32(c.i64.cast([0,22]))),c.i64.cast([511,4294967295])),c.i64.cast([0,1e5])),c.i64.cast([0,100])))),void 0,a[4],void 0,void 0,a[3],a[5],void 0,void 0,void 0,void 0,void 0,d[18],!1)},function(b){return c.i64.eq(c.i64.cast([0,1]),c.i64.cast([0,1]))?c.i64.eq(c.i64.cast([0,2]),c.i64.cast([0,1]))?(d[23]=c.createArray(),d[25]=(d[23].push("Successfully issued message backup task. act thread id = "),d[23]),d[25]=(d[23].push(a[0]),d[23]),d[25]=(d[23].push(", otid = "),d[23]),d[25]=(d[23].push(a[1]),d[23]),d[24]=d[23].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageRemove] ","",d[24]].join("")),c.resolve()):(d[23]=c.createArray(),d[25]=(d[23].push("Successfully issued message remove task. act thread id = "),d[23]),d[25]=(d[23].push(a[0]),d[23]),d[25]=(d[23].push(", otid = "),d[23]),d[25]=(d[23].push(a[1]),d[23]),d[24]=d[23].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageRemove] ","",d[24]].join("")),c.resolve()):(d[23]=c.createArray(),d[25]=(d[23].push("Successfully issued thread remove task. act thread id = "),d[23]),d[25]=(d[23].push(a[0]),d[23]),d[24]=d[23].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageRemove] ","",d[24]].join("")),c.resolve())},function(a){return d[22]=new c.Map(),d[22].set("task_id",d[21]),a=[d[22],void 0],d[14]=a[0],d[15]=a[1],a}]):c.sequence([function(b){return d[18]=c.createArray(),d[21]=(d[18].push("Skipping message upload since EB is disabled. act thread id = "),d[18]),d[21]=(d[18].push(a[0]),d[18]),d[21]=(d[18].push(", otid = "),d[18]),d[21]=(d[18].push(a[1]),d[18]),d[19]=d[18].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageRemove] ","",d[19]].join("")),c.resolve()},function(a){return d[20]=new c.Map(),d[20].set("error_code",c.i64.cast([0,24])),d[20].set("stored_procedure","LSEncryptedBackupsIssueMessageRemoveStoredProcedure"),d[20].set("error_message",""),a=[void 0,d[20]],d[14]=a[0],d[15]=a[1],a}])},function(a){return a=[d[14],d[15]],d[2]=a[0],d[3]=a[1],a}]))})},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[8]="Finishing execution. Execution time: ",d[9]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageRemove] ",d[7],d[8],d[7],d[9],d[7],d[10]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[11]=",",d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"issueMessageRemove",[d[8],d[11],d[9],d[11],d[10]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[2],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSIssueMessageRemoveStoredProcedure",["LSIssueMessageRemove"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.actThreadId;d[1]=b.otid;d[2]=b.authoritativeTs;d[3]=b.source;d[4]=b.traceId;d[5]=b.error;return c("LSIssueMessageRemove").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSTamThreadSubtype",[],(function(a,b,c,d,e,f){a=Object.freeze({STANDARD:0,VANISH_MODE:1,DUAL_SEND_SHADOW:2,BTV_COMPANION:3,BLEND_DUAL_SEND:4,BLEND_DUAL_SEND_NO_NETWORK:5});f["default"]=a}),66);
__d("LSDeleteMessageFromMPS",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][deleteMessageFromMPS] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.filter(c.db.table(303).fetch(),function(b){return b.threadId===a[0]&&b.offlineThreadingId===a[1]}).next().then(function(a,b){b=a.done;a=a.value;return b?d[2]=!1:(a.item,d[2]=!0)})},function(b){return d[2]?c.resolve(d[4]=!1):c.sequence([function(b){return d[11]=void 0,d[12]=!1,d[13]=c.i64.cast([-1,4294967295]),c.filter(c.db.table(301).fetch(),function(b){return b.threadId===a[0]&&b.offlineThreadingId===a[1]}).next().then(function(a,b){var c=a.done;a=a.value;return c?0:(b=a.item,d[11]=b.messagePayload,d[12]=b.isLocalOnlyMessage,d[13]=b.messageTimestampMs)})},function(b){return c.db.table(303).add({pk:void 0,deletedMessagePayload:d[11],threadId:a[0],offlineThreadingId:a[1],deletionOfflineThreadingId:a[4],deletionTimestampMs:a[2],isLocalOnlyMessage:d[12],messageTimestampMs:d[13]})},function(b){return c.forEach(c.filter(c.db.table(301).fetch(),function(b){return b.threadId===a[0]&&b.offlineThreadingId===a[1]}),function(a){return a["delete"]()})},function(b){return c.blobs.neq(a[3],void 0)?a[4]!==void 0?c.db.table(301).add({pk:void 0,messagePayload:a[3],threadId:a[0],offlineThreadingId:a[1],messageTimestampMs:d[13],isLocalOnlyMessage:d[12]}):c.resolve():c.resolve()},function(a){return d[4]=!0}])},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[8]="Finishing execution. Execution time: ",d[9]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][deleteMessageFromMPS] ",d[7],d[8],d[7],d[9],d[7],d[10]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[11]=",",d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"deleteMessageFromMPS",[d[8],d[11],d[9],d[11],d[10]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=d[4]}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSWriteSupplementalMessage",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][writeSupplementalMessage] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.filter(c.db.table(302).fetch(),function(b){return b.threadId===a[1]&&b.toplevelOfflineThreadingId===a[2]&&b.supplementalKey===a[3]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[2]=void 0:(b=a.item,d[2]=b.messageTimestampMs)})},function(b){return c.i64.neq(d[2],void 0)?c.sequence([function(b){return c.i64.gt(d[2],a[5])?c.resolve(d[11]=!1):c.sequence([function(b){return c.forEach(c.filter(c.db.table(302).fetch(),function(b){return b.threadId===a[1]&&b.toplevelOfflineThreadingId===a[2]&&b.supplementalKey===a[3]}),function(a){return a["delete"]()})},function(b){return c.db.table(302).add({pk:void 0,messagePayload:a[0],threadId:a[1],toplevelOfflineThreadingId:a[2],supplementalKey:a[3],offlineThreadingId:a[4],messageTimestampMs:a[5]})},function(a){return d[11]=!0}])},function(a){return d[4]=d[11]}]):c.sequence([function(b){return c.forEach(c.filter(c.db.table(302).fetch(),function(b){return b.threadId===a[1]&&b.toplevelOfflineThreadingId===a[2]&&b.supplementalKey===a[3]}),function(a){return a["delete"]()})},function(b){return c.db.table(302).add({pk:void 0,messagePayload:a[0],threadId:a[1],toplevelOfflineThreadingId:a[2],supplementalKey:a[3],offlineThreadingId:a[4],messageTimestampMs:a[5]})},function(a){return d[4]=!0}])},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[8]="Finishing execution. Execution time: ",d[9]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][writeSupplementalMessage] ",d[7],d[8],d[7],d[9],d[7],d[10]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[11]=",",d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"writeSupplementalMessage",[d[8],d[11],d[9],d[11],d[10]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=d[4]}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSWriteTopLevelMessage",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][writeTopLevelMessage] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.filter(c.db.table(301).fetch(),function(b){return b.threadId===a[1]&&b.offlineThreadingId===a[2]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[2]=void 0:(b=a.item,d[2]=b.messageTimestampMs)})},function(b){return c.i64.neq(d[2],void 0)?c.sequence([function(b){return c.i64.gt(d[2],a[3])?c.resolve(d[11]=!1):c.sequence([function(b){return c.filter(c.db.table(303).fetch(),function(b){return b.threadId===a[1]&&b.offlineThreadingId===a[2]}).next().then(function(a,b){b=a.done;a=a.value;return b?d[12]=!1:(a.item,d[12]=!0)})},function(b){return d[12]?c.sequence([function(b){return c.forEach(c.filter(c.db.table(303).fetch(),function(b){return b.threadId===a[1]&&b.offlineThreadingId===a[2]}),function(b){var c=b.update;b.item;return c({deletedMessagePayload:a[0],isLocalOnlyMessage:a[4],messageTimestampMs:a[3]})})},function(b){return c.forEach(c.filter(c.db.table(301).fetch(),function(b){return b.threadId===a[1]&&b.offlineThreadingId===a[2]&&c.i64.eq(b.messageTimestampMs,c.i64.cast([-1,4294967295]))}),function(b){var c=b.update;b.item;return c({messageTimestampMs:a[3]})})},function(a){return d[14]=!1}]):c.sequence([function(b){return c.forEach(c.filter(c.db.table(301).fetch(),function(b){return b.threadId===a[1]&&b.offlineThreadingId===a[2]}),function(a){return a["delete"]()})},function(b){return c.db.table(301).add({pk:void 0,messagePayload:a[0],threadId:a[1],offlineThreadingId:a[2],messageTimestampMs:a[3],isLocalOnlyMessage:a[4]})},function(a){return d[14]=!0}])},function(a){return d[11]=d[14]}])},function(a){return d[4]=d[11]}]):c.sequence([function(b){return c.filter(c.db.table(303).fetch(),function(b){return b.threadId===a[1]&&b.offlineThreadingId===a[2]}).next().then(function(a,b){b=a.done;a=a.value;return b?d[11]=!1:(a.item,d[11]=!0)})},function(b){return d[11]?c.sequence([function(b){return c.forEach(c.filter(c.db.table(303).fetch(),function(b){return b.threadId===a[1]&&b.offlineThreadingId===a[2]}),function(b){var c=b.update;b.item;return c({deletedMessagePayload:a[0],isLocalOnlyMessage:a[4],messageTimestampMs:a[3]})})},function(b){return c.forEach(c.filter(c.db.table(301).fetch(),function(b){return b.threadId===a[1]&&b.offlineThreadingId===a[2]&&c.i64.eq(b.messageTimestampMs,c.i64.cast([-1,4294967295]))}),function(b){var c=b.update;b.item;return c({messageTimestampMs:a[3]})})},function(a){return d[13]=!1}]):c.sequence([function(b){return c.forEach(c.filter(c.db.table(301).fetch(),function(b){return b.threadId===a[1]&&b.offlineThreadingId===a[2]}),function(a){return a["delete"]()})},function(b){return c.db.table(301).add({pk:void 0,messagePayload:a[0],threadId:a[1],offlineThreadingId:a[2],messageTimestampMs:a[3],isLocalOnlyMessage:a[4]})},function(a){return d[13]=!0}])},function(a){return d[4]=d[13]}])},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[8]="Finishing execution. Execution time: ",d[9]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][writeTopLevelMessage] ",d[7],d[8],d[7],d[9],d[7],d[10]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[11]=",",d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"writeTopLevelMessage",[d[8],d[11],d[9],d[11],d[10]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=d[4]}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("MAWWriteToMPSTables",["FBLogger","LSDeleteMessageFromMPSStoredProcedure","LSFactory","LSWriteSupplementalMessageStoredProcedure","LSWriteTopLevelMessageStoredProcedure","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,d,e){var f=d.backupActionType,g=d.offlineThreadingId,i=d.protobuf,j=d.serverTs,k=d.supplementalKey;d=d.topLevelOfflineThreadingId;switch(f){case 1:return c("LSWriteTopLevelMessageStoredProcedure")(c("LSFactory")(a),{isLocalOnlyMessage:!1,messagePayload:i.buffer,messageTimestampMs:j,offlineThreadingId:g,threadId:e});case 2:if(d==null||k==null)throw c("FBLogger")("labyrinth_web").mustfixThrow("Missing offline threading Id or supplemental key");return c("LSWriteSupplementalMessageStoredProcedure")(c("LSFactory")(a),{messagePayload:i.buffer,messageTimestampMs:j,offlineThreadingId:g,supplementalKey:k,threadId:e,toplevelOfflineThreadingId:d});case 3:case 4:return c("LSDeleteMessageFromMPSStoredProcedure")(c("LSFactory")(a),{deletionTimestampMs:j,offlineThreadingId:g,threadId:e});default:return(h||(h=b("Promise"))).resolve()}}g.writeToMPSTables=a}),98);
__d("isInstamadilloEB",["qex"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("qex")._("695")===!0}g["default"]=a}),98);
__d("MAWBridgeUploadMessageHandler",["FBLogger","I64","LSDataTraceCheckPoint","LSEncryptedBackupsBackupTenancy","LSFactory","LSIntEnum","LSIssueMessageBackupStoredProcedure","LSIssueMessageRemoveStoredProcedure","LSMEBTaskCreationSource","LSShape","LSTamThreadSubtype","MAWEBFrontendQPLLogger","MAWEncryptedBackupUtils","MAWReceiveToUploadUtils","MAWTraceUtils","MAWWriteToMPSTables","Promise","WALogger","WAStanzaUtils","asyncToGeneratorRuntime","isInstamadillo","isInstamadilloEB","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] uploadMessage.authTs is null for the message"]);k=function(){return a};return a}var l=c("requireDeferred")("EncryptedBackupTaskIssuedFalcoEvent").__setRef("MAWBridgeUploadMessageHandler");function a(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){if(c("isInstamadilloEB")())return(j||(j=b("Promise"))).resolve();var f=e.protoMsg,g=e.traceId,m=(yield d("MAWEncryptedBackupUtils").getBackupTenancy(a,g));if(m==null||!(h||(h=d("I64"))).equal(m,(i||(i=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION))){d("MAWEBFrontendQPLLogger").addPointAndEndFlowUploadMessageBackup(g,"user_device_not_enrolled_invalid_echo_request");d("MAWTraceUtils").recordCheckpointForTrace(e.traceId,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_WEB_UPLOAD_USER_DEVICE_NOT_ENROLLED),[],!1);d("MAWTraceUtils").recordInvalidUploadRequestAndFlushTrace(e.traceId,i.ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_WEB_ECHO_MESSAGE_UPLOAD_INVALID_REQUEST),[]);return}m=e.echoDocument;g=e.authTs;if(g==null){d("WALogger").ERROR(k());return}if(e.actionType===1){var n=e.echoEncodingLatencyNs,o=e.errorCode,p=e.errorMessage;d("MAWEBFrontendQPLLogger").addPointUploadMessageBackup(e.traceId,"issuing_message_backup");var q;if(f!=null)try{yield d("MAWWriteToMPSTables").writeToMPSTables(a,f,e.threadId),q=d("LSShape").ofRecord({act_thread_id:e.threadId,attachment_payload:null,backup_action:(i||(i=d("LSIntEnum"))).ofNumber(f.backupActionType),message_timestamp_ms:f.serverTs,supplemental_key:f.supplementalKey,toplevel_offline_threading_id:f.offlineThreadingId})}catch(a){c("FBLogger")("labyrinth_web").mustfix("[labyrinth_web] Error writing to MPSTables for the upload message")}yield c("LSIssueMessageBackupStoredProcedure")(c("LSFactory")(a),{actThreadId:e.threadId,authoritativeTs:(h||(h=d("I64"))).of_float(g*1e3),echoDocument:(f=m)!=null?f:"",echoEncodingLatencyNs:n!=null?(h||(h=d("I64"))).of_float(n):void 0,error:o!=null?(i||(i=d("LSIntEnum"))).ofNumber(o):void 0,errorMessage:p!=null?p:void 0,isInstamadillo:c("isInstamadillo")(),otid:e.messageId,protobufBackupContext:q,source:(i||(i=d("LSIntEnum"))).ofNumber(c("LSMEBTaskCreationSource").TAM),tamThreadSubtype:i.ofNumber(c("isInstamadillo")()?c("LSTamThreadSubtype").BLEND_DUAL_SEND:c("LSTamThreadSubtype").STANDARD),traceId:e.traceId});d("MAWEBFrontendQPLLogger").endEBUploadTracking(d("WAStanzaUtils").toStanzaId(e.messageId));d("MAWReceiveToUploadUtils").checkUploadEligbility(e.messageId)&&void l.load().then(function(a){return a.log(function(){return{message_id:e.messageId,trace_id:e.traceId}})})}else e.actionType===2&&(yield c("LSIssueMessageRemoveStoredProcedure")(c("LSFactory")(a),{actThreadId:e.threadId,authoritativeTs:(h||(h=d("I64"))).of_float(g*1e3),otid:e.messageId,source:(i||(i=d("LSIntEnum"))).ofNumber(c("LSMEBTaskCreationSource").TAM),traceId:e.traceId}))});return m.apply(this,arguments)}g.call=a}),98);
__d("MAWBridgeUploadMessageByBatchHandler",["MAWBridgeTraceRecordCheckpointHandler","MAWBridgeUploadMessageHandler","Promise","QPLUserFlow","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){e.qpl.forEach(function(a){return c("QPLUserFlow").addPoint(a.event,a.action.name,{instanceKey:a.instanceKey,timestamp:a.timestamp})});for(var f of e.messages)yield d("MAWBridgeUploadMessageHandler").call(a,f);return(h||(h=b("Promise"))).all(e.checkPoint.map(function(b){return d("MAWBridgeTraceRecordCheckpointHandler").call(a,b)})).then(function(a){})});return i.apply(this,arguments)}g.call=a}),98);
__d("MAWChatOpenTabForUser",["I64","LSDatabaseSingleton","LSIntEnum","MAWCreateOneToOneThread","MAWMiActOnMiThreadReadyForChatId","MWChatStateActions","MWChatStateV2Types","Promise","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function a(a,e,f){c("promiseDone")((k||(k=c("LSDatabaseSingleton"))).then(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(c){var g=(yield d("MAWCreateOneToOneThread").call(c,(i||(i=d("I64"))).of_string(a)));yield c.runInTransaction(function(a){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,g.chatId,"MAWChatOpenTabForUser",function(a,c){f(d("MWChatStateActions").openTab(Date.now(),{shouldFocus:!e},{threadKeyDescriptor:{clientThreadKey:c,threadKey:c,threadType:(j||(j=d("LSIntEnum"))).ofNumber(15)},type:d("MWChatStateV2Types").MWChatStateTabType.ChatTab}));return(h||(h=b("Promise"))).resolve()})},"readonly")});return function(a){return c.apply(this,arguments)}}()))}g.openChatTab=a}),98);
__d("MAWDYIRestoreThreadsFromOccamadillo",["I64","LSFactory","LSIntEnum","LSThreadsRangesQueryStoredProcedure","MAWBridgeFireAndForget","MAWEBFrontendQPLLogger","MAWJids","Promise","ReQL","WALoggerDeferred","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["User not enrolled in Occamadillo, cannot restore threads and initiate DYI"]);k=function(){return a};return a}var l={contents:(j||(j=d("I64"))).zero},m={contents:j.zero};function n(a,e){var f=[],g=[];d("MAWEBFrontendQPLLogger").logDyiE2EProcessThreadsFromOccamadillo(e);c("promiseDone")(d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.table("mi_act_mapping_table"))).then(function(i){c("promiseDone")(i.reduce(function(b,c){return b.then(function(){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("threads")).getKeyRange(c.serverThreadKey)).then(function(a){if(a==null)return;a=a.threadType;if(!(j||(j=d("I64"))).equal(a,(j||(j=d("I64"))).of_string("15"))){if(!(j||(j=d("I64"))).equal(a,(j||(j=d("I64"))).of_string("16")))return;f.push(d("MAWJids").toGroupJid((j||(j=d("I64"))).to_string(c.jid)));return}g.push(d("MAWJids").toUserJid((j||(j=d("I64"))).to_string(c.jid)))})})},(h||(h=b("Promise"))).resolve()).then(function(a){return d("MAWBridgeFireAndForget").fireAndForget("backend","dyiGetThreadList",{qplInstanceKeyE2E:(a=e)!=null?a:void 0,threadJids:f.concat(g)})}))}))}function o(a,e){var f=d("ReQL").fromTableAscending(a.table("inbox_threads_ranges")),g={contents:function(){}};g.contents=f.subscribe(function(b,f){if(f.operation==="put"){var h=f.value;b=f.value.syncGroup;if(!(j||(j=d("I64"))).equal(b,(j||(j=d("I64"))).of_string("95")))return;if(h.hasMoreBefore){(!(j||(j=d("I64"))).equal(h.minThreadKey,l.contents)||!(j||(j=d("I64"))).equal(h.minLastActivityTimestampMs,m.contents))&&(l.contents=h.minThreadKey,m.contents=h.minLastActivityTimestampMs,c("promiseDone")(a.runInTransaction(function(a){return c("LSThreadsRangesQueryStoredProcedure")(c("LSFactory")(a),{additionalPagesToFetch:(j||(j=d("I64"))).zero,isLoadingAfter:!1,isLoadingBefore:!0,maxLastActivityTimestampMs:j.max_int,maxThreadKey:j.max_int,minLastActivityTimestampMs:h.minLastActivityTimestampMs,minThreadKey:h.minThreadKey,parentThreadKey:j.zero,shouldSkipE2eeThreadsRanges:!1})},"readwrite")));return}g.contents();n(a,e)}});return(h||(h=b("Promise"))).resolve()}function p(a,b){c("promiseDone")(d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.table("inbox_threads_ranges"))).then(function(e){e.forEach(function(e){if(!(j||(j=d("I64"))).equal(e.syncGroup,(j||(j=d("I64"))).of_string("95")))return;else if(e.hasMoreBefore){c("promiseDone")(o(a,b).then(function(){l.contents=e.minThreadKey;m.contents=e.minLastActivityTimestampMs;return a.runInTransaction(function(a){return c("LSThreadsRangesQueryStoredProcedure")(c("LSFactory")(a),{additionalPagesToFetch:(j||(j=d("I64"))).zero,isLoadingAfter:!1,isLoadingBefore:!0,maxLastActivityTimestampMs:j.max_int,maxThreadKey:j.max_int,minLastActivityTimestampMs:e.minLastActivityTimestampMs,minThreadKey:e.minThreadKey,parentThreadKey:j.zero,shouldSkipE2eeThreadsRanges:!1})},"readwrite")}));return}return n(a,b)})}))}function a(a,b){if(c("gkx")("7006")){c("promiseDone")(a.runInTransaction(function(a){return a.table("encrypted_backups_dyi_backup_restore_status").put({currentStatus:(i||(i=d("LSIntEnum"))).ofNumber(0),pk:(j||(j=d("I64"))).zero})},"readwrite").then(function(){return p(a,b)}));return}c("promiseDone")(d("WALoggerDeferred").WARN(k()))}g.call=a}),98);
__d("MWChatEncryptedBackupsHandleRestoreWrapper.react",["cr:4013","cr:5605","cr:5615","cr:5743","cr:5764","cr:5765","cr:7129","cr:7594"],(function(a,b,c,d,e,f,g){"use strict";var h=(c=(f=(e=(d=(c=b("cr:7594"))!=null?c:b("cr:5605"))!=null?d:b("cr:5615"))!=null?e:b("cr:5743"))!=null?f:b("cr:5764"))!=null?c:b("cr:5765");function a(){b("cr:7129")==null?void 0:b("cr:7129")();b("cr:4013")==null?void 0:b("cr:4013")();h==null?void 0:h();return null}g["default"]=a}),98);
__d("LSProcessBackupIds",["LSAppendDataTraceAddon","LSIsMobileClient","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsProcessBackupIdsStoredProcedure] Beginning execution."),a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1487]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[1]=a[0],a})},function(a){return d[1]?d[2]=!0:d[2]=!1,d[2]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[11],c.i64.cast([0,3]))):c.resolve()},function(e){return c.db.table(172).fetch([[[c.i64.cast([0,1])]]]).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1488]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[11]=a[0],a})},function(a){return d[11]?d[12]=!0:d[12]=!1,d[12]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[13],c.i64.cast([0,3]))):c.resolve()},function(a){return d[3]=c.i64.cast([0,0])}]):(f=e.item,c.sequence([function(e){return d[13]=f.backupId,d[12]=f.authorityLevel,c.i64.eq(d[12],c.i64.cast([0,20]))?c.resolve(d[11]=c.i64.cast([0,1])):c.sequence([function(e){return c.i64.eq(d[12],c.i64.cast([0,80]))?c.sequence([function(e){return c.i64.eq(d[13],void 0)?c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1492]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[16]?d[17]=!0:d[17]=!1,d[17]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[18]=c.createArray(),void 0!==void 0?d[19]=(d[18].push(void 0),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[18],c.i64.cast([0,3]))):c.resolve()},function(a){return d[15]=c.i64.cast([0,2])}]):c.sequence([function(e){return c.i64.eq(d[13],c.i64.cast([-1,4294967295]))?c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1489]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[17]=a[0],a})},function(a){return d[17]?d[18]=!0:d[18]=!1,d[18]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[19]=c.createArray(),void 0!==void 0?d[20]=(d[19].push(void 0),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[19],c.i64.cast([0,3]))):c.resolve()},function(a){return d[16]=c.i64.cast([-1,4294967295])}]):c.sequence([function(e){return c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.backupId,d[13])&&c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}).next().then(function(e,f){f=e.done;e=e.value;return f?c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1490]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[19]=a[0],a})},function(a){return d[19]?d[20]=!0:d[20]=!1,d[20]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[21]=c.createArray(),void 0!==void 0?d[22]=(d[21].push(void 0),d[21]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[21],c.i64.cast([0,3]))):c.resolve()},function(a){return d[17]=c.i64.cast([0,4])}]):(e.item,c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1491]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[19]=a[0],a})},function(a){return d[19]?d[20]=!0:d[20]=!1,d[20]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[21]=c.createArray(),void 0!==void 0?d[22]=(d[21].push(void 0),d[21]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[21],c.i64.cast([0,3]))):c.resolve()},function(a){return d[17]=c.i64.cast([0,3])}]))})},function(a){return d[16]=d[17]}])},function(a){return d[15]=d[16]}])},function(a){return d[14]=d[15]}]):c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1489]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[15]=a[0],a})},function(a){return d[15]?d[16]=!0:d[16]=!1,d[16]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[17]=c.createArray(),void 0!==void 0?d[18]=(d[17].push(void 0),d[17]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[17],c.i64.cast([0,3]))):c.resolve()},function(a){return d[14]=c.i64.cast([-1,4294967295])}])},function(a){return d[11]=d[14]}])},function(a){return d[3]=d[11]}]))})},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[8]="Finishing execution. Execution time: ",d[9]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsProcessBackupIdsStoredProcedure] ",d[7],d[8],d[7],d[9],d[7],d[10]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[11]=",",d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsProcessBackupIdsStoredProcedure",[d[8],d[11],d[9],d[11],d[10]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=d[3]}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSProcessBackupIdsStoredProcedure",["LSProcessBackupIds"],(function(a,b,c,d,e,f,g){function a(a,b){b===void 0&&(b={});var d=[];d[0]=b.traceId;return c("LSProcessBackupIds").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("MWEncryptedBackupsProcessBackupIds",["FBLogger","LSFactory","LSIntEnum","LSProcessBackupIdsStoredProcedure","Promise","ReQL","gkx","promiseDone","qex"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("gkx")("7110")||((e=c("qex")._("352"))!=null?e:!1)||((f=c("qex")._("362"))!=null?f:!1)||((e=c("qex")._("371"))!=null?e:!1)||((f=c("qex")._("408"))!=null?f:!1)||((e=c("qex")._("411"))!=null?e:!1);function k(a){if(j)return a.runInTransaction(function(a){return c("LSProcessBackupIdsStoredProcedure")(c("LSFactory")(a))},"readwrite").then(function(a){return(i||(i=d("LSIntEnum"))).unwrapIntEnum(a[0])});else return(h||(h=b("Promise"))).resolve(0)}function a(a,b){return a.table("encrypted_backups").subscribe(function(){c("promiseDone")(d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.table("encrypted_backups"))),function(d){if(d!=null){c("promiseDone")(k(a),b,function(a){c("FBLogger")("labyrinth_web").catching(a).info("Error in db transaction")});return}})})}g.processBackupIdsStoredProcedure=k;g.subscribeToEncryptedBackupsRow=a}),98);
__d("LSOptimisticUpdateThreadDisappearingSetting",["LSIssueNewError","LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return c.sortBy(c.db.table(115).fetch(),[["timestampMs","DESC"]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[0]=!1:(b=a.item,d[0]=b.errorShouldBeShown)})},function(a){return d[0]===!0?c.sequence([function(a){return c.localizeV2Async(c.i64.cast([0,2285622730]),void 0).then(function(a){return d[4]=a})},function(a){return c.localizeV2Async(c.i64.cast([0,1919524925]),void 0).then(function(a){return d[5]=a})},function(a){return c.storedProcedure(b("LSIssueNewError"),void 0,c.i64.cast([0,1545093]),d[4],d[5],void 0,void 0)}]):c.resolve()},function(e){return d[2]=new c.Map(),d[2].set("wa_jid",void 0),d[2].set("thread_key",a[0]),d[2].set("disappearing_ttl",a[1]),d[2].set("updated_timestamp",a[2]),d[2].set("updated_by",a[3]),d[2].set("sync_group",c.i64.cast([0,95])),d[3]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewTask"),"disappearing_setting",c.i64.cast([0,714]),d[3],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSOptimisticUpdateThreadDisappearingSettingStoredProcedure",["LSOptimisticUpdateThreadDisappearingSetting"],(function(a,b,c,d,e,f,g){function a(a,b){b===void 0&&(b={});var d=[];d[0]=b.threadKey;d[1]=b.disappearingTtl;d[2]=b.updatedTimestamp;d[3]=b.updatedBy;return c("LSOptimisticUpdateThreadDisappearingSetting").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("MAWEphemeralSettingsUpdate",["FBLogger","I64","LSOptimisticUpdateThreadDisappearingSettingStoredProcedure","MAWChatJid","MAWCurrentUser","Promise","WAJids","asyncToGeneratorRuntime","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("requireDeferred")("LSDatabaseSingletonLazyWrapper").__setRef("MAWEphemeralSettingsUpdate"),k=c("requireDeferred")("LSFactory").__setRef("MAWEphemeralSettingsUpdate"),l=c("requireDeferred")("WATimeUtils").__setRef("MAWEphemeralSettingsUpdate");function m(a,b,c,d){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){a=(yield a.table("threads").get(e));if(a!=null){e=a.disappearingSettingUpdatedTs;a=a.disappearingSettingTtl;if(e==null||a==null)return!0;if((i||(i=d("I64"))).lt(e,(i||(i=d("I64"))).of_float(c))&&!(i||(i=d("I64"))).equal(a,(i||(i=d("I64"))).of_int32(b)))return!0}return!1});return n.apply(this,arguments)}function o(a,b,c,d,e,f){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,j,l){var n=(yield m(a,e,f,g));if(!n)return(h||(h=b("Promise"))).resolve();j&&c("FBLogger")("labyrinth_web").addMetadata("LABYRINTH_WEB","APP_VERSION","OCCAM_EPHEMERAL_SETTINGS_UPDATE").info("[Occam][Web] Ephemeral Settings Updated.");n=(yield k.load());return c("LSOptimisticUpdateThreadDisappearingSettingStoredProcedure")(n(a),{disappearingTtl:(i||(i=d("I64"))).of_int32(e),threadKey:g,updatedBy:i.of_string((j=l)!=null?j:d("MAWCurrentUser").getID()),updatedTimestamp:i.of_float(f)})});return p.apply(this,arguments)}function a(a,b,c){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var d=(yield j.load());d=(yield d());return d.runInTransaction(function(d){return o(d,a,b,c,!1)},"readwrite")});return q.apply(this,arguments)}function e(a,b,c,d){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f){var g=(yield j.load());g=(yield g());return g.runInTransaction(function(){var g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(g){var i=(yield d("MAWChatJid").toThreadKeyMaybe(g,d("WAJids").threadIdForChatJid(e)));return i!=null?o(g,a,(yield l.load()).castUnixTimeToMillisTime(c),i,f):(h||(h=b("Promise"))).resolve()});return function(a){return g.apply(this,arguments)}}(),"readwrite")});return r.apply(this,arguments)}g.updateEphemeralSettingsWithTxn=o;g.updateEphemeralSettings=a;g.updateEphemeralSettingsByChatJid=e}),98);
__d("LSUserVisibleErrorsUtil",["LSFactory","LSRemoveErrorStoredProcedure","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){c("promiseDone")(a.runInTransaction(function(a){return c("LSRemoveErrorStoredProcedure")(c("LSFactory")(a),{errorId:b})},"readwrite"))}g.removeUserVisibleErrorFromTable=a}),98);
__d("MAWSecretConversationsLogout",["FBLogger","Promise","QPLUserFlow","SharedWorkerBundleResource","asyncTimeout","asyncToGeneratorRuntime","cr:6600","ifRequired","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){c("QPLUserFlow").start(c("qpl")._(25309731,"17"),{annotations:{bool:{userInitiated:a}},cancelOnUnload:!0,timeoutInMs:3e3})}function j(){c("QPLUserFlow").endSuccess(c("qpl")._(25309731,"17"))}function a(a){i(a);a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield c("ifRequired")("MAWSetupWorker",function(a){return a.killSharedWorkerOrTerminateWebWorkerTmp("logout")},function(){return d("SharedWorkerBundleResource").terminateSharedWorker(b("cr:6600"))})}catch(a){c("FBLogger")("messenger_e2ee_web").catching(a).mustfix("Error in removeCurrentDevice of the Armadillo logout flow")}finally{j()}});return function(){return a.apply(this,arguments)}}();return(h||(h=b("Promise"))).race([a()["catch"](function(a){c("FBLogger")("messenger_e2ee_web").catching(a).mustfix("Error in the Armadillo logout flow");return(h||(h=b("Promise"))).resolve()}),c("asyncTimeout")(3e3)])}g["default"]=a}),98);
__d("useEBStateDBLogout",["MWEncryptedBackupsLocalStorageEntryEnum","Promise","WebStorage","cr:6694","getMWEncryptedBackupsIsLocalStorageSupported","qex"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(e=c("qex")._("573"))!=null?e:!1;function a(){var a,e=d("getMWEncryptedBackupsIsLocalStorageSupported").getMWEncryptedBackupsIsLocalStorageSupported();a=(a=(i||(i=c("WebStorage"))).getLocalStorageForRead())==null?void 0:a.getItem(c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_REMEMBER_BROWSER_CONSENT);e=e?a!=null:!1;if(b("cr:6694")==null)return(h||(h=b("Promise"))).resolve();return j&&e?(h||(h=b("Promise"))).resolve(b("cr:6694").clearEBIDBNonPersistedRows()):(h||(h=b("Promise"))).resolve(b("cr:6694").deleteEBIDB())}g.logoutEBStateDB=a}),98);
__d("secretConversationsCleanupOnLogout",["FBLogger","Promise","cr:3570","cr:6886","useEBStateDBLogout"],(function(a,b,c,d,e,f,g){"use strict";var h,i=b("cr:6886")?b("cr:6886")==null?void 0:b("cr:6886").logout:function(){return(h||(h=b("Promise"))).resolve()},j=(e=b("cr:3570"))!=null?e:function(a){return(h||(h=b("Promise"))).resolve()};function a(a){return(h||(h=b("Promise"))).allSettled([i(),j(a),d("useEBStateDBLogout").logoutEBStateDB()]).then(function(a){a.forEach(function(a){a.status==="rejected"&&(a.reason!=null&&a.reason instanceof Error&&c("FBLogger")("messenger_e2ee_web").catching(a.reason).mustfix("Caught error during logout, reason: %s",a.reason.message),c("FBLogger")("messenger_e2ee_web").mustfix("Caught non-Error during logout, reason: %s",a.reason))})})}g["default"]=a}),98);
__d("useMAWSecurityAlertsPreferences",["MAWBridgeFireAndForget","MAWBridgeSendAndReceive","promiseDone","react"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");var i=b.useCallback,j=b.useEffect,k=b.useState;function a(){var a=k(),b=a[0],e=a[1];j(function(){c("promiseDone")(d("MAWBridgeSendAndReceive").sendAndReceive("backend","getSecurityAlertSettingForSelfAndContact").then(function(a){e(a)}))},[]);return{onContactSecurityAlertsPreferencesChange:i(function(a){b!=null&&e(babelHelpers["extends"]({},b,{allowSecurityAlertForContact:a})),d("MAWBridgeFireAndForget").fireAndForget("backend","changeSecurityAlertSetting",{isEnableAlert:a})},[b]),onSelfSecurityAlertsPreferencesChange:i(function(a){b!=null&&e(babelHelpers["extends"]({},b,{allowSecurityAlertForSelf:a})),d("MAWBridgeFireAndForget").fireAndForget("backend","changeSecurityAlertSettingForSelf",{isEnableSelfAlert:a})},[b]),securityAlertsPreferences:b}}g["default"]=a}),98);
__d("useMWJewelSettingsButtonSecurityAlertsBadge",["CometBadge.react","MAWStateContext.react","react","useMAWSecurityAlertsPreferences"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react")),j=h.useMemo,k=function(a){return a.unArchivedSelfDeviceChangeAlerts};function a(){var a=c("useMAWSecurityAlertsPreferences")(),b=a.securityAlertsPreferences,e=d("MAWStateContext.react").useMAWSelector(k);return j(function(){return{badge:(b==null?void 0:b.allowSecurityAlertForSelf)&&e>0?i.jsx("div",{className:"x1j1mzgm x10l6tqk x12ibf10",children:i.jsx(c("CometBadge.react"),{testid:void 0})}):null}},[b==null?void 0:b.allowSecurityAlertForSelf,e])}g["default"]=a}),98);
__d("MWXIconCautionTriangle",["MWXSvgIcon","SVGIcon","cr:7577","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgIcon(d("SVGIcon").svgIcon(b("cr:7577")),c("gkx")("571")||c("gkx")("386"));g["default"]=a}),98);
__d("MWXImage.react",["cr:1261","cr:2838","cr:6682","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var c=a.objectFit,d=a.src;a=babelHelpers.objectWithoutPropertiesLoose(a,["objectFit","src"]);if(b("cr:6682")!=null)return i.jsx(b("cr:6682"),babelHelpers["extends"]({objectFit:c,src:d},a));if(typeof d==="string")return b("cr:2838")!=null?i.jsx(b("cr:2838"),babelHelpers["extends"]({src:d},a)):null;else return b("cr:1261")!=null?i.jsx(b("cr:1261"),babelHelpers["extends"]({src:d},a)):null}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWXQPCard.react",["MWXIconStrict.react","MWXImage.react","cr:2831","cr:2832","cr:6676","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a,d){var e=a.addOnPrimary,f=a.addOnSecondary,g=a.icon;a=babelHelpers.objectWithoutPropertiesLoose(a,["addOnPrimary","addOnSecondary","icon"]);var h;if(g!=null)switch(g.type){case"image":h=i.jsx(c("MWXImage.react"),babelHelpers["extends"]({},g.props));break;case"icon":h=i.jsx(c("MWXIconStrict.react"),babelHelpers["extends"]({},g.props));break;default:g.type}if(b("cr:2832")!=null)return i.jsx("div",{className:"xw7yly9 xktsk01 x1yztbdb x1d52u69",ref:d,children:i.jsx(b("cr:2832"),babelHelpers["extends"]({},a,{headlineNumberOfLines:2,icon:h,primaryCallToAction:e&&{disabled:e.disabled,label:e.label,linkProps:e.linkProps,onPress:e.onPress,reduceEmphasis:e.reduceEmphasis},secondaryCallToAction:f&&{disabled:f.disabled,label:f.label,linkProps:f.linkProps,onPress:f.onPress,reduceEmphasis:f.reduceEmphasis}}))});else if(b("cr:2831")!=null&&b("cr:6676")!=null)return i.jsx("div",{className:"x1lq5wgf xgqcy7u x30kzoy x9jhf4c xnw9j1v x14vqqas xq8finb xod5an3 x16n37ib",ref:d,children:i.jsx(b("cr:2831"),babelHelpers["extends"]({},a,{addOnPrimary:e&&i.jsx(b("cr:6676"),{align:"justify",expanding:!0,paddingHorizontal:12,primary:e,secondary:f}),icon:h,level:4,type:"primary"}))});return null}a.displayName=a.name+" [from "+f.id+"]";e=i.forwardRef(a);g["default"]=e}),98);
__d("MAWUserVisibleErrorsNux.react",["ix","MAWBridgeUIEventQPLLogger","MWXIconCautionTriangle","MWXQPCard.react","QPLUserFlow","gkx","qpl","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react")),k=i.useEffect;function a(a){var b=a.nuxBodyText,e=a.nuxButtonProps,f=a.nuxTitleText;a=a.onCloseButtonClick;var g=d("MAWBridgeUIEventQPLLogger").getInstanceKey();k(function(){c("QPLUserFlow").start(c("qpl")._(1056846286,"652"),{annotations:{string:{nuxTitleText:f.toString()}},instanceKey:g});return function(){return c("QPLUserFlow").endSuccess(c("qpl")._(1056846286,"652"),{instanceKey:g})}},[g,f]);return j.jsx("div",{"data-testid":void 0,children:j.jsx(c("MWXQPCard.react"),{addOnPrimary:e,body:b,headline:f,icon:c("gkx")("571")?{props:{src:h("212797")},type:"image"}:{props:{color:"negative",icon:c("MWXIconCautionTriangle"),size:24},type:"icon"},onClose:a})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("LSAppState",[],(function(a,b,c,d,e,f){a=Object.freeze({BACKGROUND:0,FOREGROUND:1});f["default"]=a}),66);
__d("LSReportAppState",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return d[0]=new c.Map(),d[0].set("app_state",a[0]),d[0].set("request_id",a[1]),d[1]=c.toJSON(d[0]),c.storedProcedure(b("LSIssueNewTask"),"ls_presence_report_app_state",c.i64.cast([0,123]),d[1],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),c.i64.cast([0,6]),void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSReportAppStateStoredProcedure",["LSReportAppState"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.appState;d[1]=b.requestId;return c("LSReportAppState").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("useMWPReportPresence",["I64","LSAppState","LSFactory","LSReportAppStateStoredProcedure","MsgrPresenceUpdateFalcoEvent","gkx","promiseDone","react","useReStore","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=(j||d("react")).useCallback;function a(){var a=(h||(h=c("useReStore")))();return k(function(b){var e=c("uuidv4")();c("gkx")("6049")&&c("MsgrPresenceUpdateFalcoEvent").log(function(){return{client_request_id:e,event_type:"app_state_update",is_foregrounded:b===c("LSAppState").FOREGROUND,is_new_ls_presence_reporting:!0}});c("promiseDone")(a.runInTransaction(function(a){return c("LSReportAppStateStoredProcedure")(c("LSFactory")(a),{appState:(i||(i=d("I64"))).of_float(b),requestId:e})},"readwrite"))},[a])}g["default"]=a}),98);
__d("useMWPPresenceManager",["LSAppState","Run","react","useDebouncedComet","useGlobalEventListener","useMWPReportPresence"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");var i=b.useCallback,j=b.useEffect,k=b.useRef;function a(){var a=k(c("LSAppState").FOREGROUND),b=c("useMWPReportPresence")(),e=i(function(){b(a.current)},[b]),f=c("useDebouncedComet")(e,{wait:2e3});e=i(function(){a.current=c("LSAppState").FOREGROUND,f()},[f]);var g=i(function(){a.current=c("LSAppState").BACKGROUND,f()},[f]);c("useGlobalEventListener")("focus",e);c("useGlobalEventListener")("blur",g);j(function(){b(c("LSAppState").FOREGROUND);var a=d("Run").onBeforeUnload(function(){b(c("LSAppState").BACKGROUND)},!1);return function(){return a.remove()}},[b])}g.useMWPPresenceManager=a}),98);
__d("MWSetupPresenceReporting.react",["useMWPPresenceManager"],(function(a,b,c,d,e,f,g){"use strict";function a(){d("useMWPPresenceManager").useMWPPresenceManager();return null}g["default"]=a}),98);
__d("MWChatSearchResultTypeMapping",["LSSearchType","MWChatSearchResultType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case c("MWChatSearchResultType").GROUP:return c("LSSearchType").GROUP;case c("MWChatSearchResultType").MESSAGE:return c("LSSearchType").INTEGRATED_MESSAGE_SEARCH_THREAD;case c("MWChatSearchResultType").PAGE:return c("LSSearchType").PAGE;case c("MWChatSearchResultType").USER:return c("LSSearchType").CONTACT;case c("MWChatSearchResultType").AI_BOT:return c("LSSearchType").AI_BOT}}g.mapMWChatSearchResultTypeToLSSearchType=a}),98);
__d("MWChatSearchIssueMAWFTSQuery",["I64","LSContactBitOffset","LSDatabaseSingleton","LSIntEnum","LSMessagingThreadTypeUtil","LSSearchGranularSurfaceType","LSSearchType","MAWBridgeSendAndReceive","MAWThreadId","MNetRankType","MWChatSearchResultTypeMapping","MWChatTemporarySearchResult","MWInboxSecureContentSearch","MWLSThreadTitle","MWSearchStandardResultTypeMappings","Promise","ReQL","ReQLSuspense","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function l(a,b,e){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("contacts")).getKeyRange((j||(j=d("I64"))).of_string(b))).then(function(f){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("ig_contact_info")).getKeyRange((j||(j=d("I64"))).of_string(b))).then(function(g){if(f!=null)return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("ranking_scores")).getKeyRange((j||(j=d("I64"))).of_string(b),(k||(k=d("LSIntEnum"))).ofNumber(c("MNetRankType").MESSENGER_USER_SEARCH))).then(function(a){return d("MWChatTemporarySearchResult").fromContact((a=a)!=null?a:void 0,void 0,f,(a=g)!=null?a:void 0,"secure",e)})})})}function m(a,b,e,f,g){return d("MAWThreadId").toThreadKeyMaybe_DEPRECATED(a,b).then(function(b){if(b!=null)return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("threads")).getKeyRange(b)).then(function(a){var h;return{displayName:(h=f)!=null?h:"",id:e,imageUrl:"",isAiBot:a!=null&&(j||(j=d("I64"))).equal(a.threadType,(k||(k=d("LSIntEnum"))).ofNumber(201)),isContact:!1,isE2EE:a!=null?d("LSMessagingThreadTypeUtil").isSecure(a.threadType):!1,isEPD:!1,isInstagramAccount:!1,isVerified:!1,matchedTerms:g,resultType:d("MWChatTemporarySearchResult").getResultType((k||(k=d("LSIntEnum"))).ofNumber(c("LSSearchType").INTEGRATED_MESSAGE_SEARCH_THREAD)),searchResultType:14,searchSource:"secure",section:"",subtext:"",threadKey:b}})})}function n(a,c){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(c.table("mi_act_mapping_table")).getKeyRange(a)).then(function(a){if(a!=null)return d("ReQL").firstAsync(d("ReQL").fromTableAscending(c.table("cutover_threads")).filter(function(b){return(j||(j=d("I64"))).equal(b.armadilloThreadId,a.jid)})).then(function(b){if(b!=null)return b.openThreadId;else return a.jid});else return(i||(i=b("Promise"))).resolve()})}function o(a){var b=a.score-1e-6;return{contactId:a.contactId,contactType:a.contactType,score:b,scoreIndex:a.scoreIndex,scoreType:a.scoreType}}function p(a,b){return n(a,b).then(function(e){var f=e!=null?e:a,g=e!=null;return d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.table("ranking_scores")).getKeyRange(f,(k||(k=d("LSIntEnum"))).ofNumber(c("MNetRankType").MESSENGER_USER_SEARCH))).then(function(a){if(a!=null)if(g)return o(a);else return a})})}function q(a,b,e,f){var g;g=(g=b.threadDescription)!=null?g:"";(j||(j=d("I64"))).equal(a,(k||(k=d("LSIntEnum"))).ofNumber(c("LSSearchGranularSurfaceType").INSTAGRAM_ALL))&&(g=d("MWLSThreadTitle").getThreadTitleWithSecondaryNames(b.threadDescription,e,f,b.threadType).toString());return g}function r(a,b,c,d){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,g,h){e=(yield (i||(i=b("Promise"))).all([d("MAWThreadId").toThreadKeyMaybe_DEPRECATED(a,e),d("ReQLSuspense").firstExn(d("ReQL").fromTableAscending(a.table("_user_info")).map(function(a){return a.facebookUserId}),f.id+":232")]));var l=e[0];e=e[1];if(l==null)return;l=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("threads")).getKeyRange(l)));if(l==null||l.folderName!=="inbox")return;var m=(yield i.all([d("MWInboxSecureContentSearch").getThreadPics(l,e,a),d("MWInboxSecureContentSearch").getThreadParticipants(l,a),p(l.threadKey,a)])),n=m[0],o=m[1];m=m[2];var r=n[0];n=n[1];var s=d("LSMessagingThreadTypeUtil").isOneToOne(l.threadType),t=d("LSMessagingThreadTypeUtil").isGroup(l.threadType)?(k||(k=d("LSIntEnum"))).ofNumber(c("LSSearchType").GROUP):(k||(k=d("LSIntEnum"))).ofNumber(c("LSSearchType").CONTACT),u=null;s===!0&&(u=(yield d("MWInboxSecureContentSearch").getOtherContactOrSelf(l.threadKey,e,a)));return{displayName:d("MWLSThreadTitle").getDefaultThreadTitle(l.threadName,e,o,l.threadType).toString(),id:(j||(j=d("I64"))).to_string(l.threadKey),imageUrl:r,isAiBot:j.equal(l.threadType,(k||(k=d("LSIntEnum"))).ofNumber(201)),isContact:s,isE2EE:d("LSMessagingThreadTypeUtil").isSecure(l.threadType),isEPD:!1,isInstagramAccount:!1,isVerified:u!=null?d("LSContactBitOffset").has(23,u):!1,matchedTerms:h,otherUserId:u?(j||(j=d("I64"))).to_string(u.id):void 0,rankingScore:m,resultType:d("MWChatTemporarySearchResult").getResultType(t),searchResultType:d("MWSearchStandardResultTypeMappings").mapThreadTypeToSearchStandardResultType(l.threadType),searchSource:"secure",secondaryImageUrl:n,section:"",subtext:q(g,l,e,o),threadKey:l.threadKey,threadType:l.threadType}});return s.apply(this,arguments)}function t(a,b,e){var g=d("ReQLSuspense").firstExn(d("ReQL").fromTableAscending(a.table("_user_info")).map(function(a){return a.facebookUserId}),f.id+":319");return d("MAWThreadId").toThreadKeyMaybe_DEPRECATED(a,b).then(function(b){if(b!=null)return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("threads")).getKeyRange(b)).then(function(f){if(f!=null)return d("MWInboxSecureContentSearch").getThreadPics(f,g,a).then(function(a){var g;return{displayName:(g=f.threadName)!=null?g:"",id:(j||(j=d("I64"))).to_string(b),imageUrl:a[0],isAiBot:j.equal(f.threadType,(k||(k=d("LSIntEnum"))).ofNumber(201)),isContact:!1,isE2EE:d("LSMessagingThreadTypeUtil").isSecure(f.threadType),isEPD:!1,isInstagramAccount:!1,isVerified:!1,matchedTerms:e,resultType:d("MWChatTemporarySearchResult").getResultType(k.ofNumber(c("LSSearchType").GROUP)),searchResultType:3,searchSource:"secure",secondaryImageUrl:a[1],section:"",subtext:(g=f.threadDescription)!=null?g:"",threadKey:b}})})})}function u(a,b){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,d){var e=(yield h||(h=c("LSDatabaseSingleton")));a=(yield (i||(i=b("Promise"))).all(a.map(function(a){switch(a.recordType){case"msg":return m(e,a.chatId,a.msgId,a.content,a.matchedTerms);case"groupInfo":return t(e,a.threadId,a.matchedTerms);case"contact":return l(e,a.fbid,a.matchedTerms);case"participant":return r(e,a.threadId,d,a.matchedTerms)}})));return a.filter(Boolean)});return v.apply(this,arguments)}function w(a,b,e){return a.filter(function(a){a=(k||(k=d("LSIntEnum"))).ofNumber(d("MWChatSearchResultTypeMapping").mapMWChatSearchResultTypeToLSSearchType(a.resultType));var f=b.includes(a);if(!f)return!1;f=(j||(j=d("I64"))).equal(a,k.ofNumber(c("LSSearchType").GROUP));return!f||e})}function a(a,b,c,e){return d("MAWBridgeSendAndReceive").sendAndReceive("backend","search",{search:e.query},1e4).then(function(a){return u(a,b)}).then(function(b){return w(b,a,c)})}g.filterSearchResults=w;g.fetchResults=a}),98);
__d("MWXMenu.react",["cr:12346","react"],(function(a,b,c,d,e,f,g){"use strict";var h;h||d("react");g["default"]=b("cr:12346")}),98);
__d("MWXMenuItem.react",["BaseTheme.react","MWXSvgIcon","MWXThreadThemeColor","cr:4265","cr:4318","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react")),j=h.useMemo;function a(a,c){var e=a.icon,f=a.iconColor;a=babelHelpers.objectWithoutPropertiesLoose(a,["icon","iconColor"]);var g=f instanceof d("MWXThreadThemeColor").MWXThreadThemeColor?"primary":f;if(b("cr:4318")!=null)return i.jsx(k,{iconColor:f,children:i.jsx(b("cr:4318"),babelHelpers["extends"]({icon:e,iconColor:g},a,{ref:c}))});return b("cr:4265")!=null?i.jsx(k,{iconColor:f,children:i.jsx(b("cr:4265"),babelHelpers["extends"]({icon:e instanceof d("MWXSvgIcon").MWXSvgIcon?e.component:e,iconColor:g},a,{ref:c}))}):null}a.displayName=a.name+" [from "+f.id+"]";function k(a){var b=a.children,e=a.iconColor;a=j(function(){return e instanceof d("MWXThreadThemeColor").MWXThreadThemeColor?{dark:{"primary-icon":e.color},light:{"primary-icon":e.color},type:"VARIABLES"}:void 0},[e]);return a==null?b:i.jsx(c("BaseTheme.react"),{config:a,children:b})}k.displayName=k.name+" [from "+f.id+"]";e=i.forwardRef(a);g["default"]=e}),98);
__d("useMWV2ChatCloseTabs",["MWChatStateActions","MWChatStateContext","MWChatStateV2.react","MessengerWebEventsFalcoEvent","react","useCometFeedNoRoutingNavigationEventLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useCallback;function a(){var a=c("useCometFeedNoRoutingNavigationEventLogger")(),b=d("MWChatStateContext").useChatState(function(a){return a.tabs}),e=d("MWChatStateV2.react").useDispatch();return i(function(){a(Date.now(),"","messenger");c("MessengerWebEventsFalcoEvent").log(function(){return{event_name:"close_all_chat_tabs"}});var f=Date.now();return e(Array.from(b.values()).flatMap(function(a){return d("MWChatStateActions").closeTab(f,a.tabId)}))},[e,b,a])}g["default"]=a}),98);
__d("useMWV2ChatMinimizeTabs",["MWChatStateActions","MWChatStateContext","MWChatStateV2.react","MWChatStateV2IsOpen","MessengerWebEventsFalcoEvent","react","useCometFeedNoRoutingNavigationEventLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useCallback;function a(){var a=c("useCometFeedNoRoutingNavigationEventLogger")(),b=d("MWChatStateContext").useChatState(function(a){return a.tabs}),e=d("MWChatStateV2.react").useDispatch();return i(function(){a(Date.now(),"","messenger");c("MessengerWebEventsFalcoEvent").log(function(){return{event_name:"minimize_all_chat_tabs"}});var f=Date.now();return e(Array.from(b.values()).filter(function(a){return d("MWChatStateV2IsOpen").isOpen(void 0,a)}).flatMap(function(a){return d("MWChatStateActions").minimizeTab(f,a.tabId)}))},[e,b,a])}g["default"]=a}),98);
__d("MWV2ChatOptionsHeadPopover.react",["fbt","ix","MWXMenu.react","MWXMenuItem.react","fbicon","react","useMWV2ChatCloseTabs","useMWV2ChatMinimizeTabs"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k=j||d("react");function a(a){var b=a.hasOpenTabs;babelHelpers.objectWithoutPropertiesLoose(a,["hasOpenTabs"]);var e=c("useMWV2ChatCloseTabs")(),f=c("useMWV2ChatMinimizeTabs")();return k.jsxs(c("MWXMenu.react"),{withArrow:!0,children:[k.jsx(c("MWXMenuItem.react"),{icon:d("fbicon")._(i("491584"),20),onClick:function(a){return e()},primaryText:h._("Close all chats"),testid:void 0}),b?k.jsx(c("MWXMenuItem.react"),{icon:d("fbicon")._(i("518013"),20),onClick:function(a){return f()},primaryText:h._("Minimize open chats"),testid:void 0}):null]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("LSDatabaseSingletonLazyWrapper",["LSDatabaseSingleton"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return h||(h=c("LSDatabaseSingleton"))}g["default"]=a}),98);
__d("MWPReplyLogging",["I64","QPLUserFlow","deepEquals","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Map();function j(a){var b=Date.now()|0;i.set((h||(h=d("I64"))).to_string(a),b);return b}function k(a){var b=i.get((h||(h=d("I64"))).to_string(a));if(b==null)return j(a);else return b}function a(a,b,e){if(e){a?c("QPLUserFlow").endCancel(c("qpl")._(25298086,"3996"),{instanceKey:k(b)}):c("QPLUserFlow").endSuccess(c("qpl")._(25298086,"3996"),{instanceKey:k(b)});i["delete"]((h||(h=d("I64"))).to_string(b));return}}function b(a,b,d){if(a!=null){if(c("deepEquals")(a,b)){c("QPLUserFlow").addPoint(c("qpl")._(25298086,"3996"),"same_message",{instanceKey:k(d)});return}if(!c("deepEquals")(a,b)){a=k(d);c("QPLUserFlow").addPoint(c("qpl")._(25298086,"3996"),"switch_message",{instanceKey:a});c("QPLUserFlow").endCancel(c("qpl")._(25298086,"3996"),{instanceKey:a});c("QPLUserFlow").start(c("qpl")._(25298086,"3996"),{cancelOnUnload:!0,instanceKey:j(d),timeoutInMs:6e4});return}}c("QPLUserFlow").start(c("qpl")._(25298086,"3996"),{cancelOnUnload:!0,instanceKey:j(d),timeoutInMs:6e4})}g.logClearReply=a;g.logSetReply=b}),98);
__d("VideoPlayerAudioTrackUtils",["fbt"],(function(a,b,c,d,e,f,g,h){"use strict";var i=function(a,b){if(b==null)return void 0;a=String(a).substring(0,2);try{return new Intl.DisplayNames([a],{type:"language"}).of(b)}catch(a){return void 0}};a=function(a,b){if(a==null)return h._("Default");b=i(b,a.lang);b=(b=b)!=null?b:h._("Default");var c=null;a.role==="dub"?c=h._("Dubbed"):(a==null?void 0:a.role)==="description"&&(c=h._("Description"));return c!=null?b.toString()+" - "+c.toString():b};g.getAudioTrackLabelLocalized=a}),98);
__d("VideoPlayerScrubberRenderer.react",["CometRelay","VideoPlayerScrubberBaseContentDefault.react","VideoPlayerScrubberRenderer_video.graphql","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||d("react");function a(a){var e=a.scrubberProps;a=a.video;a=d("CometRelay").useFragment(h!==void 0?h:h=b("VideoPlayerScrubberRenderer_video.graphql"),a);return(a==null?void 0:a.video_player_scrubber_base_content_renderer)==null?j.jsx(c("VideoPlayerScrubberBaseContentDefault.react"),babelHelpers["extends"]({},e)):j.jsx(d("CometRelay").MatchContainer,{match:a==null?void 0:a.video_player_scrubber_base_content_renderer,props:babelHelpers["extends"]({},e)})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("VideoPlayerSettingsMenuAudioTrackPane.react",["fbt","ix","CometImage.react","CometPressable.react","CurrentLocale","FocusRegion.react","VideoPlayerAudioTrackUtils","VideoPlayerHooks","VideoPlayerSettingsMenu.react","focusScopeQueries","react","stylex"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k,l,m=k||d("react"),n={chevronLeft:{alignItems:"x6s0dn4",display:"x3nfvp2",marginBottom:"xmgb6t1",marginStart:"x139jcc6",marginLeft:null,marginRight:null,$$css:!0},menuHeading:{alignItems:"x6s0dn4",color:"x14ctfv",cursor:"x1ypdohk",display:"x78zum5",fontWeight:"x1s688f",":hover_textDecoration":"x1lku1pv",$$css:!0},menuLabel:{cursor:"x1ypdohk",display:"x1rg5ohu",$$css:!0},menuOption:{marginStart:"x17adc0v",marginLeft:null,marginRight:null,marginTop:"x1anpbxc",textTransform:"xn80e1m",$$css:!0},menuOptionRow:{color:"x14ctfv",display:"x1lliihq",minWidth:"xfvyar9",outline:"x1a2a7pz",paddingTop:"xyqdw3p",paddingEnd:"x4uap5",paddingBottom:"xg8j3zb",paddingStart:"xkhd6sd",textAlign:"x1yc453h",$$css:!0},pressableOption:{width:"xh8yej3",$$css:!0},radio:{backgroundColor:"xiakxrv",borderTopStartRadius:"x1ykpwxx",borderTopEndRadius:"x118zf8b",borderBottomEndRadius:"xnwxkdh",borderBottomStartRadius:"xfocsrx",display:"x1rg5ohu",marginBottom:"xmgb6t1",marginEnd:"xmo9yow",marginLeft:null,marginRight:null,paddingTop:"x1yrsyyn",paddingEnd:"xsyo7zv",paddingBottom:"x10b6aqq",paddingStart:"x16hj40l",$$css:!0},radioDot:{backgroundColor:"x14hiurz",borderTopStartRadius:"x8u2fvd",borderTopEndRadius:"x1ht7hnu",borderBottomEndRadius:"x1quq95r",borderBottomStartRadius:"x5yzy4c",display:"x1rg5ohu",height:"xqu0tyb",marginStart:"x8182xy",marginLeft:null,marginRight:null,marginTop:"x1kgmq87",position:"x10l6tqk",width:"x51ohtg",$$css:!0},selectedOption:{fontWeight:"x1s688f",$$css:!0}};function a(a){var b=a.availableAudioTracks,e=a.selectedAudioTrackID,f=a.setPane,g=(l||(l=d("VideoPlayerHooks"))).useController();return m.jsx(d("FocusRegion.react").FocusRegion,{autoFocusQuery:d("focusScopeQueries").headerFirstTabbableSecondScopeQuery,recoverFocusQuery:d("focusScopeQueries").headerFirstTabbableSecondScopeQuery,children:m.jsxs("div",{"data-testid":void 0,children:[m.jsx("div",{className:"x6s0dn4 x14ctfv x1ypdohk x78zum5 x1s688f x1lku1pv",children:m.jsxs(c("CometPressable.react"),{onPress:function(){return f(d("VideoPlayerSettingsMenu.react").VideoPlayerSettingsMenuPaneType.MAIN)},testid:void 0,xstyle:n.pressableOption,children:[m.jsx("span",{className:"x6s0dn4 x3nfvp2 xmgb6t1 x139jcc6",children:m.jsx(c("CometImage.react"),{src:i("480579")})}),h._("Audio")]})}),m.jsx("div",{className:"x17adc0v x1anpbxc xn80e1m","data-testid":void 0,children:b.map(function(a){var b=e===a.id,f=d("VideoPlayerAudioTrackUtils").getAudioTrackLabelLocalized(a,c("CurrentLocale").get());return m.jsx("div",{children:m.jsxs(c("CometPressable.react"),{onPress:function(){g.selectAudioTrackID(a.id)},testid:void 0,xstyle:n.menuOptionRow,children:[m.jsx("div",{className:"xiakxrv x1ykpwxx x118zf8b xnwxkdh xfocsrx x1rg5ohu xmgb6t1 xmo9yow x1yrsyyn xsyo7zv x10b6aqq x16hj40l",children:b&&m.jsx("div",{className:"x14hiurz x8u2fvd x1ht7hnu x1quq95r x5yzy4c x1rg5ohu xqu0tyb x8182xy x1kgmq87 x10l6tqk x51ohtg","data-testid":void 0})}),m.jsx("div",{className:(j||(j=c("stylex")))(n.menuLabel,b&&n.selectedOption),"data-testid":void 0,children:f})]})},a.id)})})]})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("CautionTriangleFilled12.svg.react",["react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){return i.jsxs("svg",babelHelpers["extends"]({viewBox:"0 0 12 13",width:"1em",height:"1em",fill:"currentColor"},a,{children:[a.title!=null&&i.jsx("title",{children:a.title}),a.children!=null&&i.jsx("defs",{children:a.children}),i.jsx("g",{fillRule:"evenodd",transform:"translate(-450 -1073)",children:i.jsx("path",{d:"m456.998 1077.516-.25 2.833c-.033.368-.358.651-.748.651s-.715-.283-.747-.651l-.25-2.833a.968.968 0 0 1 .998-1.015.968.968 0 0 1 .997 1.015zM456 1083.5a1.001 1.001 0 1 1 1-1c0 .551-.449 1-1 1zm1.114-8.877a1.26 1.26 0 0 0-1.094-.623h-.002a1.26 1.26 0 0 0-1.095.62l-4.747 7.996c-.23.388-.234.853-.011 1.245.227.4.64.64 1.106.64h9.459c.464 0 .877-.24 1.105-.638.223-.39.22-.856-.009-1.244l-4.712-7.996z"})})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;b=a;g["default"]=b}),98);
__d("ArmadilloCutoverClientFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("699");b=d("FalcoLoggerInternal").create("armadillo_cutover_client",a);e=b;g["default"]=e}),98);
__d("EncryptedBackupTaskIssuedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5726");b=d("FalcoLoggerInternal").create("encrypted_backup_task_issued",a);e=b;g["default"]=e}),98);
__d("WebStorageManagerEstimatesFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("2144");b=d("FalcoLoggerInternal").create("web_storage_manager_estimates",a);e=b;g["default"]=e}),98);
__d("MWXButtonGroup.react",["cr:227","cr:258","cr:5023","cr:5028","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var c=a.align,d=a.direction;d=d===void 0?"backward":d;var e=a.expanding;e=e===void 0?!1:e;var f=a.paddingHorizontal;f=f===void 0?0:f;var g=a.primary;a=a.secondary;if(b("cr:258")!=null){var h,j=g.icon,k=g.loading,l=g.type,m=babelHelpers.objectWithoutPropertiesLoose(g,["icon","loading","type"]);l=l==="destructive"?"fdsOverride_negative":l;var n=f===10?8:f;return i.jsx(b("cr:258"),{align:(h=c)!=null?h:"end",direction:d,expanding:e,paddingHorizontal:n,primary:babelHelpers["extends"]({},m,{addOnPrimary:k===!0&&b("cr:5023")?i.jsx(b("cr:5023"),{color:"disabled",size:16}):void 0,icon:j==null?void 0:j.component,type:l}),secondary:a!=null?babelHelpers["extends"]({},a,{icon:(h=a.icon)==null?void 0:h.component,reduceEmphasis:!0,type:"secondary"}):null})}if(b("cr:227")!=null){e=g.icon;n=g.loading;m=babelHelpers.objectWithoutPropertiesLoose(g,["icon","loading"]);return i.jsx(b("cr:227"),{align:c,direction:d,paddingHorizontal:f,primary:babelHelpers["extends"]({},m,{addOnStart:n===!0&&b("cr:5028")?i.jsx(b("cr:5028"),{color:"grey",size:24}):void 0,icon:e==null?void 0:e.originalComponent}),secondary:a!=null?babelHelpers["extends"]({},a,{icon:(k=a.icon)==null?void 0:k.originalComponent}):null})}return null}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);